// Do not edit this file; automatically generated by build.py.
'use strict';

Blockly.smartAgri = new Blockly.Generator("smartAgri");

Blockly.smartAgri.addReservedWords("setup,loop,if,else,for,switch,case,while,do,break,continue,return,goto,define,include,HIGH,LOW,INPUT,OUTPUT,INPUT_PULLUP,true,false,interger, constants,floating,point,void,bookean,char,unsigned,byte,int,word,long,float,double,string,String,array,static, volatile,const,sizeof,pinMode,digitalWrite,digitalRead,analogReference,analogRead,analogWrite,tone,noTone,shiftOut,shitIn,pulseIn,millis,micros,delay,delayMicroseconds,min,max,abs,constrain,map,pow,sqrt,sin,cos,tan,randomSeed,random,lowByte,highByte,bitRead,bitWrite,bitSet,bitClear,bit,attachInterrupt,detachInterrupt,interrupts,noInterrupts");

Blockly.smartAgri.ORDER_ATOMIC=0;
Blockly.smartAgri.ORDER_UNARY_POSTFIX=1;
Blockly.smartAgri.ORDER_UNARY_PREFIX=2;
Blockly.smartAgri.ORDER_MULTIPLICATIVE=3;
Blockly.smartAgri.ORDER_ADDITIVE=4;
Blockly.smartAgri.ORDER_SHIFT=5;
Blockly.smartAgri.ORDER_RELATIONAL=6;
Blockly.smartAgri.ORDER_EQUALITY=7;
Blockly.smartAgri.ORDER_BITWISE_AND=8;
Blockly.smartAgri.ORDER_BITWISE_XOR=9;
Blockly.smartAgri.ORDER_BITWISE_OR=10;
Blockly.smartAgri.ORDER_LOGICAL_AND=11;
Blockly.smartAgri.ORDER_LOGICAL_OR=12;
Blockly.smartAgri.ORDER_CONDITIONAL=13;
Blockly.smartAgri.ORDER_ASSIGNMENT=14;
Blockly.smartAgri.ORDER_NONE=99;

var GlobalVariableBaudRate = 9600;

var profile={
	smartAgri:{
		description:"smartAgri standard-compatible board",
		interrupt:[["INT0","2"],["INT1","3"]],
		interruptanddigital:[["INT0","2"],["INT1","3"],["D4","4"],["D5","5"],["D6","6"],["D7","7"],["D8","8"],["D9","9"]],
		type_print:[["BIN","BIN"],["OCT","OCT"],["DEC","DEC"],["HEX","HEX"],["0","0"],["2","2"],["4","4"]],
		digital:[["D4","4"],["D5","5"],["D6","6"],["D7","7"],["D8","8"],["D9","9"]],
		analog:[["ADC0","0"],["ADC1","1"],["ADC2","2"],["ADC3","3"],["ADC4","4"],["ADC5","5"],["ADC6","6"],["ADC7","7"]],
		inputX:[["X0","0"],["X1","1"],["X2","2"],["X3","3"],["X4","4"],["X5","5"],["X6","6"],["X7","7"],["X8","8"],["X9","9"],["X10","10"],["X11","11"],["X12","12"],["X13","13"],["X14","14"],["X15","15"]],
		outputY:[["Y0","0"],["Y1","1"],["Y2","2"],["Y3","3"],["Y4","4"],["Y5","5"],["Y6","6"],["Y7","7"],["Y8","8"],["Y9","9"],["Y10","10"],["Y11","11"],["Y12","12"],["Y13","13"],["Y14","14"],["Y15","15"]],
		adc:[["ADC0","0"],["ADC1","1"],["ADC2","2"],["ADC3","3"],["ADC4","4"],["ADC5","5"],["ADC6","6"],["ADC7","7"]],
		lcdletter:[["C1","0"],["C2","1"],["C3","2"],["C4","3"],["C5","4"],["C6","5"],["C7","6"],["C8","7"],["C9","8"],["C10","9"],["C11","10"],["C12","11"],["C13","12"],["C14","13"],["C15","14"],["C16","15"]],
		lcdcursor:[["R1","0"],["R2","1"],["R3","2"],["R4","3"]],
		sevenseg_digit:[["DIGIT1","0"],["DIGIT2","1"],["DIGIT3","2"],["DIGIT4","3"],["DIGIT5","4"],["DIGIT6","5"],["DIGIT7","6"],["DIGIT8","7"]],
		serial:9600
	},
	smartAgri_mega:{
		description:"smartAgri Mega-compatible board"
	}
};
profile["default"]=profile.smartAgri;

Blockly.smartAgri.init=function(a){
	Blockly.smartAgri.definitions_=Object.create(null);
	Blockly.smartAgri.include_=Object.create(null);
	Blockly.smartAgri.setups_=Object.create(null);
	Blockly.smartAgri.init_=Object.create(null);
	Blockly.smartAgri.function_=Object.create(null);
	Blockly.smartAgri.variable_=Object.create(null);
	Blockly.smartAgri.inloop_=Object.create(null);
	Blockly.smartAgri.variableDB_?Blockly.smartAgri.variableDB_.reset():Blockly.smartAgri.variableDB_=new Blockly.Names(Blockly.smartAgri.RESERVED_WORDS_);
	var b=[];
	a=Blockly.Variables.allVariables(a);
	for(var c=0;c<a.length;c++)
		b[c]="int "+Blockly.smartAgri.variableDB_.getName(a[c],Blockly.Variables.NAME_TYPE)+";\n";
		Blockly.smartAgri.definitions_.variables=b.join("\n")
};
Blockly.smartAgri.finish=function(a){
	a="  "+a.replace(/\n/g,"\n  ");
	a=a.replace(/\n\s+$/,"\n");
	//a="void loop() \n{\n"+a+"\n}";
	var b=[],c=[],f=[],v=[],l=[],s=[],d;
	for(d in Blockly.smartAgri.definitions_){
		var e=Blockly.smartAgri.definitions_[d];
		e.match(/^#include/)?b.push(e):c.push(e)
	}
	e=[];
	for(d in Blockly.smartAgri.include_)
		b.push(Blockly.smartAgri.include_[d]);
	for(d in Blockly.smartAgri.setups_)
		e.push(Blockly.smartAgri.setups_[d]);
	for(d in Blockly.smartAgri.function_)
		f.push(Blockly.smartAgri.function_[d]);
	for(d in Blockly.smartAgri.variable_)
		v.push(Blockly.smartAgri.variable_[d]);
	for(d in Blockly.smartAgri.inloop_)
		l.push(Blockly.smartAgri.inloop_[d]);
	for(d in Blockly.smartAgri.init_)
		s.push(Blockly.smartAgri.init_[d]);

	a="void loop() \n{\n"+l+a+"\n}";

	return(
		b.join("\n")+"\n\n"+
		v.join("\n")+"\n\n"+
		c.join("\n")+"\nvoid setup() \n{\n  "+
		e.join("\n  ")+"\n"+s.join("\n  ")+"\n}\n\n").replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n"+
		f.join("\n  ")+"\n\n\n").replace(/\n\n+/g,"\n\n").replace(/\n*$/,"\n\n\n")+a
};
Blockly.smartAgri.scrubNakedValue=function(a){
	return a+";\n"
};
Blockly.smartAgri.quote_=function(a){
	a=a.replace(/\\/g,"\\\\").replace(/\n/g,"\\\n").replace(/\$/g,"\\$").replace(/'/g,"\\'");return'"'+a+'"'
};
Blockly.smartAgri.scrub_=function(a,b){
	if(null===b)return"";var c="";
	if(!a.outputConnection||!a.outputConnection.targetConnection){
		var d=a.getCommentText();d&&(c+=Blockly.smartAgri.prefixLines(d,"// ")+"\n");
		for(var e=0;e<a.inputList.length;e++)
			a.inputList[e].type==Blockly.INPUT_VALUE&&(d=a.inputList[e].connection.targetBlock())&&(d=Blockly.smartAgri.allNestedComments(d))&&(c+=Blockly.smartAgri.prefixLines(d,"// "))}e=a.nextConnection&&a.nextConnection.targetBlock();
		e=Blockly.smartAgri.blockToCode(e);
		return c+b+e
};

Blockly.smartAgri.base={};
Blockly.smartAgri.base_delay=function(){
	return"delay("+(Blockly.smartAgri.valueToCode(this,"DELAY_TIME",Blockly.smartAgri.ORDER_ATOMIC)||"1000")+");\n"
};
Blockly.smartAgri.base_map=function(){
	var a=Blockly.smartAgri.valueToCode(this,"NUM",Blockly.smartAgri.ORDER_NONE),b=Blockly.smartAgri.valueToCode(this,"DMAX",Blockly.smartAgri.ORDER_ATOMIC);
	return["map("+a+", 0, 1024, 0, "+b+")",Blockly.smartAgri.ORDER_NONE]
};
Blockly.smartAgri.inout_buildin_led=function(){
	var a=this.getFieldValue("STAT");Blockly.smartAgri.setups_.setup_output_13="pinMode(LED_BUILTIN, OUTPUT);";
	return"digitalWrite(LED_BUILTIN, "+a+");\n"
};

Blockly.smartAgri.inout_digital_write=function(){
	var a=this.getFieldValue("PIN"),b=this.getFieldValue("STAT");
	Blockly.smartAgri.setups_["setup_output_"+a]="pinMode("+a+", OUTPUT);";
	return"digitalWrite("+a+", "+b+");\n"
};

Blockly.smartAgri.inout_analog_write=function(){
	var a=this.getFieldValue("PIN"),b=Blockly.smartAgri.valueToCode(this,"NUM",Blockly.smartAgri.ORDER_ATOMIC);
	return"analogWrite("+a+", "+b+");\n"
};

Blockly.smartAgri.inout_analog_read=function(){
	return["analogRead("+this.getFieldValue("PIN")+")",Blockly.smartAgri.ORDER_ATOMIC]
};


Blockly.smartAgri.new_map=function(){
	var value_val = Blockly.smartAgri.valueToCode(this, 'VAL', Blockly.smartAgri.ORDER_ATOMIC);
  	var value_max_in = Blockly.smartAgri.valueToCode(this, 'MAX_IN', Blockly.smartAgri.ORDER_ATOMIC);
  	var value_max_out = Blockly.smartAgri.valueToCode(this, 'MAX_OUT', Blockly.smartAgri.ORDER_ATOMIC);

	return["map("+value_val+",0,"+value_max_in+",0,"+value_max_out+") ",Blockly.smartAgri.ORDER_ATOMIC]
};

// new Init fucntion
Blockly.smartAgri.setup_initial=function(){

  	var statements_setup_initial = Blockly.smartAgri.statementToCode(this, 'Setup_Initial');
  	Blockly.smartAgri.init_["setups_initial"]=statements_setup_initial+"\n";
	return "" 
};

Blockly.smartAgri.pwm_out=function(){
	var dropdown_pin = this.getFieldValue('PIN');
  	var value_val_pwm = Blockly.smartAgri.valueToCode(this, 'VAL_PWM', Blockly.smartAgri.ORDER_ATOMIC);

  	Blockly.smartAgri.setups_["setups_setpin_pwm_out"]="pinMode("+dropdown_pin+", OUTPUT);";

  	Blockly.smartAgri.function_["function_pwm_out"]="void pwm_out(int _pin,int _pwmOutput){\n";
  	Blockly.smartAgri.function_["function_pwm_out"]+="\tif(_pin>=5 && _pin<=6){\n";
  	Blockly.smartAgri.function_["function_pwm_out"]+="\t\tif(_pwmOutput>=0 && _pwmOutput<=255){\n";
  	Blockly.smartAgri.function_["function_pwm_out"]+="\t\t\tanalogWrite(_pin,_pwmOutput);\n";
  	Blockly.smartAgri.function_["function_pwm_out"]+="\t\t}\n";
  	Blockly.smartAgri.function_["function_pwm_out"]+="\t}\n";
  	Blockly.smartAgri.function_["function_pwm_out"]+="}\n";

	return "pwm_out("+dropdown_pin+","+value_val_pwm+");"
};
Blockly.smartAgri.pwm_out_percent=function(){
	var dropdown_pin = this.getFieldValue('PIN');
  	var value_val_pwm = Blockly.smartAgri.valueToCode(this, 'VAL_PWM', Blockly.smartAgri.ORDER_ATOMIC);

  	Blockly.smartAgri.setups_["setups_setpin_pwm_out_percent"]="pinMode("+dropdown_pin+", OUTPUT);";

  	Blockly.smartAgri.function_["function_pwm_out_percent"]="void pwm_out_percent(int _pin,int _pwmOutput){\n";
  	Blockly.smartAgri.function_["function_pwm_out_percent"]+="\tif(_pin>=5 && _pin<=6){\n";
  	Blockly.smartAgri.function_["function_pwm_out_percent"]+="\t\tif(_pwmOutput>=0 && _pwmOutput<=100){\n";
  	Blockly.smartAgri.function_["function_pwm_out_percent"]+="\t\t\tfloat f = _pwmOutput*255; \n";
  	Blockly.smartAgri.function_["function_pwm_out_percent"]+="\t\t\tf = f/100; \n";
  	Blockly.smartAgri.function_["function_pwm_out_percent"]+="\t\t\tunsigned char getPwmOutput = f; \n";
  	Blockly.smartAgri.function_["function_pwm_out_percent"]+="\t\t\tanalogWrite(_pin,getPwmOutput);\n";
  	Blockly.smartAgri.function_["function_pwm_out_percent"]+="\t\t}\n";
  	Blockly.smartAgri.function_["function_pwm_out_percent"]+="\t}\n";
  	Blockly.smartAgri.function_["function_pwm_out_percent"]+="}\n";

	return "pwm_out_percent("+dropdown_pin+","+value_val_pwm+");"
};

//new output Y
Blockly.smartAgri.outputY_write=function(){
	var pin=this.getFieldValue("PIN"),state=this.getFieldValue("STAT");
	Blockly.smartAgri.include_["include_library_io"]="#include \"Adafruit_MCP23017.h\" //ใช้ Library ";

	Blockly.smartAgri.include_["include_library_output"]="Adafruit_MCP23017 output; // output pin 0-15";

	Blockly.smartAgri.setups_["setups_library_output"]="\toutput.begin(4); //กำหนด address เป็น 0x24\n";
	Blockly.smartAgri.setups_["setups_library_output"]+="\tfor(int i=0;i<=15;i++){\n";
	Blockly.smartAgri.setups_["setups_library_output"]+="\t\toutput.pinMode(i, OUTPUT); //กำหนดขา 0-15 เป็น Output\n";
	Blockly.smartAgri.setups_["setups_library_output"]+="\t}";
	return "output.digitalWrite("+pin+","+state+");\n"
};

//new output Y 2
Blockly.smartAgri.outputY_write_2=function(){
	var value_pin = Blockly.smartAgri.valueToCode(this, 'PIN', Blockly.smartAgri.ORDER_ATOMIC);
  	var value_stat = Blockly.smartAgri.valueToCode(this, 'STAT', Blockly.smartAgri.ORDER_ATOMIC);

	Blockly.smartAgri.include_["include_library_io"]="#include \"Adafruit_MCP23017.h\" //ใช้ Library ";

	Blockly.smartAgri.include_["include_library_output"]="Adafruit_MCP23017 output; // output pin 0-15";

	Blockly.smartAgri.setups_["setups_library_output"]="\toutput.begin(4); //กำหนด address เป็น 0x24\n";
	Blockly.smartAgri.setups_["setups_library_output"]+="\tfor(int i=0;i<=15;i++){\n";
	Blockly.smartAgri.setups_["setups_library_output"]+="\t\toutput.pinMode(i, OUTPUT); //กำหนดขา 0-15 เป็น Output\n";
	Blockly.smartAgri.setups_["setups_library_output"]+="\t}";

	return "output.digitalWrite("+value_pin+","+value_stat+");\n"
};

//new input X
Blockly.smartAgri.inputX_read=function(){
	var pin=this.getFieldValue("PIN");
	Blockly.smartAgri.include_["include_library_io"]="#include \"Adafruit_MCP23017.h\" //ใช้ Library ";

	Blockly.smartAgri.include_["include_library_input"]="Adafruit_MCP23017 input; // input pin 0-15";

	Blockly.smartAgri.setups_["setups_library_input"]="\tinput.begin(0); //กำหนด address เป็น 0x20\n";
	Blockly.smartAgri.setups_["setups_library_input"]+="\tfor(int i=0;i<=15;i++){\n";
	Blockly.smartAgri.setups_["setups_library_input"]+="\t\tinput.pinMode(i, INPUT); //กำหนดขา 0-15 เป็น Input\n";
	Blockly.smartAgri.setups_["setups_library_input"]+="\t\tinput.pullUp(i,HIGH);// กำหนดขาเป็น Input Active Low\n";
	Blockly.smartAgri.setups_["setups_library_input"]+="\t}";
	return["input.digitalRead("+pin+")",Blockly.smartAgri.ORDER_ATOMIC]
};

//new input X 2
Blockly.smartAgri.inputX_read_2=function(){
	var value_pin = Blockly.smartAgri.valueToCode(this, 'PIN', Blockly.smartAgri.ORDER_ATOMIC);
	Blockly.smartAgri.include_["include_library_io"]="#include \"Adafruit_MCP23017.h\" //ใช้ Library ";

	Blockly.smartAgri.include_["include_library_input"]="Adafruit_MCP23017 input; // input pin 0-15";

	Blockly.smartAgri.setups_["setups_library_input"]="\tinput.begin(0); //กำหนด address เป็น 0x20\n";
	Blockly.smartAgri.setups_["setups_library_input"]+="\tfor(int i=0;i<=15;i++){\n";
	Blockly.smartAgri.setups_["setups_library_input"]+="\t\tinput.pinMode(i, INPUT); //กำหนดขา 0-15 เป็น Input\n";
	Blockly.smartAgri.setups_["setups_library_input"]+="\t\tinput.pullUp(i,HIGH);// กำหนดขาเป็น Input Active Low\n";
	Blockly.smartAgri.setups_["setups_library_input"]+="\t}";
	return["input.digitalRead("+value_pin+")",Blockly.smartAgri.ORDER_ATOMIC]
};

//new input adc
Blockly.smartAgri.adc_read=function(){

	var pin=this.getFieldValue("PIN");

	Blockly.smartAgri.include_["include_library_adc"]="#include <MCP3208.h>// chip for ADC pin 0-7\n";
	Blockly.smartAgri.include_["include_library_adc"]+="MCP3208 adc(10); // control pin";

	Blockly.smartAgri.setups_["setup_library_adc"]="\tadc.begin();// ประกาศใช้ ADC";

	return["adc.analogRead("+pin+")",Blockly.smartAgri.ORDER_ATOMIC]
};


//new input sensor water flow
Blockly.smartAgri.sensor_water_flow_read=function(){

	var pin=this.getFieldValue("PIN");
	var type=this.getFieldValue("TYPE");

	Blockly.smartAgri.variable_["variable_water_flow"]="long countWaterFlow = 0;\n";
	Blockly.smartAgri.variable_["variable_water_flow"]+="long timeWaterFlow = 0;";

	Blockly.smartAgri.setups_["setup_water_flow"]="\tattachInterrupt(digitalPinToInterrupt("+pin+"), flow, RISING);\n";

	Blockly.smartAgri.function_["function_water_flow_interrupt"]="void flow (){//  Water flow Interrupt function \n";
	Blockly.smartAgri.function_["function_water_flow_interrupt"]+="\tif(timeWaterFlow==0) timeWaterFlow = millis();\n";
	Blockly.smartAgri.function_["function_water_flow_interrupt"]+="\tif(abs(millis()-timeWaterFlow)>=1000){\n";
	Blockly.smartAgri.function_["function_water_flow_interrupt"]+="\ttimeWaterFlow=0;\n";
	Blockly.smartAgri.function_["function_water_flow_interrupt"]+="\tcountWaterFlow=0;\n";
	Blockly.smartAgri.function_["function_water_flow_interrupt"]+="\t}\n";
	Blockly.smartAgri.function_["function_water_flow_interrupt"]+="\tcountWaterFlow++;// pulse 410 time per L\n";
	Blockly.smartAgri.function_["function_water_flow_interrupt"]+="}";

	if(type==0)
	{
		Blockly.smartAgri.function_["function_read_water_flow"]="float Read_Water_Flow(){ \n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\tif(countWaterFlow>0){\n";	
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t\tfloat result = (countWaterFlow)/410.0; // water flow per second\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t\ttimeWaterFlow=0;\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t\tcountWaterFlow=0;\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t\treturn result;\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t}\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\treturn 0.0;\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="}";
	}
	if(type==1)
	{
		Blockly.smartAgri.function_["function_read_water_flow"]="float Read_Water_Flow(){ \n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\tif(countWaterFlow>0){\n";	
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t\tfloat result = (countWaterFlow*60)/410.0; // water flow per min\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t\ttimeWaterFlow=0;\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t\tcountWaterFlow=0;\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t\treturn result;\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t}\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\treturn 0.0;\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="}";
	}
	if(type==2)
	{
		Blockly.smartAgri.function_["function_read_water_flow"]="float Read_Water_Flow(){ \n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\tif(countWaterFlow>0){\n";	
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t\tfloat result = (countWaterFlow*60*60)/410.0; // water flow per hour\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t\ttimeWaterFlow=0;\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t\tcountWaterFlow=0;\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t\treturn result;\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\t}\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="\treturn 0.0;\n";
		Blockly.smartAgri.function_["function_read_water_flow"]+="}";
	}


	return["Read_Water_Flow()",Blockly.smartAgri.ORDER_ATOMIC]
};


//new input sensor pH
Blockly.smartAgri.sensor_pH_read=function(){
	var pin=this.getFieldValue("PIN");

	Blockly.smartAgri.include_["include_library_adc"]="#include <MCP3208.h>// chip for ADC pin 0-7\n";
	Blockly.smartAgri.include_["include_library_adc"]+="MCP3208 adc(10); // control pin";

	Blockly.smartAgri.setups_["setup_library_adc"]="\tadc.begin();// ประกาศใช้ ADC";

	Blockly.smartAgri.function_["function_read_pH"]="float Read_pH_Meter(){\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\tunsigned long int avgValue; //Store the average value of the sensor feedback\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\tint buf[10],temp; //Variable for sort value\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\tfor(int i=0;i<10;i++){ //Get 10 sample value from the sensor for smooth the value\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\t\tbuf[i]=adc.analogRead("+pin+");\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\t\tdelay(10);\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\t}\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\tfor(int i=0;i<9;i++){ //sort the analog from small to large\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\t\tfor(int j=i+1;j<10;j++){\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\t\t\tif(buf[i]>buf[j]){\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\t\t\t\ttemp=buf[i];\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\t\t\t\tbuf[i]=buf[j];\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\t\t\t\tbuf[j]=temp;\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\t\t\t}\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\t\t}\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\t}\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\tavgValue=0;\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\tfor(int i=2;i<8;i++){//take the average value of 6 center sample\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\t\tavgValue+=buf[i];\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\t}\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\tfloat phValue= (((float)avgValue)/6 ) / 4095 * 5 ; //convert the analog into millivolt\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\tphValue=3.35*phValue; //convert the millivolt into pH value\n";
	Blockly.smartAgri.function_["function_read_pH"]+="\treturn phValue;\n";
	Blockly.smartAgri.function_["function_read_pH"]+="}";
	return["Read_pH_Meter()",Blockly.smartAgri.ORDER_ATOMIC]
};


//new input sensor temp
Blockly.smartAgri.sensor_temp_read=function(){
	var pin=this.getFieldValue("PIN");
	Blockly.smartAgri.include_["include_library_dht"]="#include <DHT.h> \n";
	Blockly.smartAgri.include_["include_library_dht"]+="#define DHTPIN "+pin+" //what pin we're connected to \n";
	Blockly.smartAgri.include_["include_library_dht"]+="#define DHTTYPE DHT22 //DHT 22  (AM2302) \n";
	Blockly.smartAgri.include_["include_library_dht"]+="DHT dht(DHTPIN, DHTTYPE); //Initialize DHT sensor for normal 16mhz Arduino";
	Blockly.smartAgri.setups_["setup_dht"]="\tdht.begin();";
	return["dht.readTemperature()",Blockly.smartAgri.ORDER_ATOMIC]

};
//new input sensor humid
Blockly.smartAgri.sensor_humid_read=function(){
	var pin=this.getFieldValue("PIN");
	Blockly.smartAgri.include_["include_library_dht"]="#include <DHT.h> \n";
	Blockly.smartAgri.include_["include_library_dht"]+="#define DHTPIN "+pin+" //what pin we're connected to \n";
	Blockly.smartAgri.include_["include_library_dht"]+="#define DHTTYPE DHT22 //DHT 22  (AM2302) \n";
	Blockly.smartAgri.include_["include_library_dht"]+="DHT dht(DHTPIN, DHTTYPE); //Initialize DHT sensor for normal 16mhz Arduino";
	Blockly.smartAgri.setups_["setup_dht"]="\tdht.begin();";
	return["dht.readHumidity()",Blockly.smartAgri.ORDER_ATOMIC]
};


//new input sensor ldr
Blockly.smartAgri.sensor_ldr_read=function(){
	var pin=this.getFieldValue("PIN");
	Blockly.smartAgri.include_["include_library_adc"]="#include <MCP3208.h>// chip for ADC pin 0-7\n";
	Blockly.smartAgri.include_["include_library_adc"]+="MCP3208 adc(10); // control pin ";

	Blockly.smartAgri.setups_["setup_library_adc"]="\tadc.begin();// ประกาศใช้ ADC";

	Blockly.smartAgri.function_["function_read_ldr"]="int Read_LDR(){\n";
	Blockly.smartAgri.function_["function_read_ldr"]+="\tint  _val = adc.analogRead("+pin+");\n";
	Blockly.smartAgri.function_["function_read_ldr"]+="\tint  maps = map(_val,0,4095,0,100);\n";
	Blockly.smartAgri.function_["function_read_ldr"]+="\tint  _result = abs(100-maps);\n";
	Blockly.smartAgri.function_["function_read_ldr"]+="\treturn _result;\n";
	Blockly.smartAgri.function_["function_read_ldr"]+="}\n";
	return["Read_LDR()",Blockly.smartAgri.ORDER_ATOMIC]
};

//new input sensor ambient light
Blockly.smartAgri.sensor_ambient_light_read=function(){
	
	Blockly.smartAgri.include_["include_library_Wire"]="#include <Wire.h>";
	Blockly.smartAgri.include_["include_library_Math"]="#include <math.h>";
	Blockly.smartAgri.variable_["variable_BH1750"]="int BH1750address = 0x23; //i2c address";

	Blockly.smartAgri.setups_["setup_library_Wire"]="\tWire.begin();";

	Blockly.smartAgri.function_["function_BH1750"]="uint16_t Read_Ambient_Light(){\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\tuint16_t val=0;\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\tbyte buff[2];\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\tWire.beginTransmission(BH1750address);\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\tWire.write(0x10);//1lx reolution 120ms\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\tWire.endTransmission();\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\tdelay(200);\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\tint i_BH1750=0;\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\tWire.beginTransmission(BH1750address);\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\tWire.requestFrom(BH1750address, 2);\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\twhile(Wire.available()) {\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\t\tbuff[i_BH1750] = Wire.read();  // receive one byte\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\t\ti_BH1750++;\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\t}\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\tWire.endTransmission();\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\tif(2==i_BH1750) {\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\t\tval = ((buff[0]<<8)|buff[1])/1.2;\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\t\treturn val;\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\t}\n";
	Blockly.smartAgri.function_["function_BH1750"]+="\treturn 0;\n";
	Blockly.smartAgri.function_["function_BH1750"]+="}";

	return["Read_Ambient_Light()",Blockly.smartAgri.ORDER_ATOMIC]
};

//new input sensor soil moisture
Blockly.smartAgri.sensor_soil_moisture_read=function(){
	var pin=this.getFieldValue("PIN");

	Blockly.smartAgri.include_["include_library_adc"]="#include <MCP3208.h>// chip for ADC pin 0-7\n";
	Blockly.smartAgri.include_["include_library_adc"]+="MCP3208 adc(10); // control pin ";

	Blockly.smartAgri.setups_["setup_library_adc"]="\tadc.begin();// ประกาศใช้ ADC";

	Blockly.smartAgri.function_["function_read_soil_moisture"]="int Read_Soil_Moisture(){\n";
	Blockly.smartAgri.function_["function_read_soil_moisture"]+="\tint  _val = adc.analogRead("+pin+");\n";
	Blockly.smartAgri.function_["function_read_soil_moisture"]+="\tint  maps = map(_val,0,4095,0,100);\n";
	Blockly.smartAgri.function_["function_read_soil_moisture"]+="\tint  _result = abs(100-maps);\n";
	Blockly.smartAgri.function_["function_read_soil_moisture"]+="\treturn _result;\n";
	Blockly.smartAgri.function_["function_read_soil_moisture"]+="}\n";
	return["Read_Soil_Moisture()",Blockly.smartAgri.ORDER_ATOMIC]
};


//new input sensor Co2
Blockly.smartAgri.sensor_co2_read=function(){
	var pin=this.getFieldValue("PIN");
	var type=this.getFieldValue("TYPE");

	Blockly.smartAgri.setups_["setup_co2"]="\tpinMode("+pin+", INPUT);";

	Blockly.smartAgri.function_["function_read_co2"]="long Read_Co2(int type){\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t //PWM output (taking PWM output from 2000ppm as example):\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t //CO2 output range: 0ppm-2000ppm \n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t //Cycle: 1004ms±5% \n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t //Datasheet : https://www.openhacks.com/uploadsproductos/mh-z14_co2.pdf \n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t long TimeStart=0,TimeHigh=0,TimeLow=0;\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t while(digitalRead("+pin+") == LOW) {;}\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t //Get Time Start Low to High\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t while(digitalRead("+pin+") == HIGH) {;}\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t TimeStart = millis();\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t //Get Time High of full range 0-1004ms\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t while(digitalRead("+pin+") == LOW) {;}\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t TimeHigh = abs(millis()-TimeStart);\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t //Get Time Low of full range 0-1004ms\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t TimeLow =  abs(1004-TimeHigh);\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t if(type==0){\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t\t // Cppm = 2000 * (TimeHigh - 2ms)/(TimeHigh + TimeLow - 4ms) \n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t\t return 2000*(TimeHigh-2)/(TimeHigh+TimeLow-4);\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t }\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t if(type==1){\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t\t //TimeHigh of PWM;\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t\t return TimeHigh;\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t }\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t if(type==2){\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t\t //TimeLow of PWM;\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t\t return TimeLow;\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t }\n";
	Blockly.smartAgri.function_["function_read_co2"]+="\t return 0;\n";
	Blockly.smartAgri.function_["function_read_co2"]+=" }\n";

	return["Read_Co2("+type+")",Blockly.smartAgri.ORDER_ATOMIC]
};

//new input sensor Co2 MG811
Blockly.smartAgri.sensor_co2_mg811_read=function(){
	var pin=this.getFieldValue("PIN");

	Blockly.smartAgri.include_["include_library_adc"]="#include <MCP3208.h>// chip for ADC pin 0-7\n";
	Blockly.smartAgri.include_["include_library_adc"]+="MCP3208 adc(10); // control pin ";

	Blockly.smartAgri.setups_["setup_library_adc"]="\tadc.begin();// ประกาศใช้ ADC";

	Blockly.smartAgri.function_["function_read_co2_mg811"]="float Read_Co2_MG811() {\n";
	Blockly.smartAgri.function_["function_read_co2_mg811"]+="\tfloat v_co2=0.0;\n";
	Blockly.smartAgri.function_["function_read_co2_mg811"]+="\tlong sum_co2 = 0;\n";
	Blockly.smartAgri.function_["function_read_co2_mg811"]+="\tfor(int i=0;i<5;i++) {\n";
	Blockly.smartAgri.function_["function_read_co2_mg811"]+="\t\tsum_co2 += adc.analogRead(0);\n";
	Blockly.smartAgri.function_["function_read_co2_mg811"]+="\t}\n";
	Blockly.smartAgri.function_["function_read_co2_mg811"]+="\tsum_co2 = sum_co2/5;\n";
	Blockly.smartAgri.function_["function_read_co2_mg811"]+="\tv_co2 = sum_co2*5.0/4095.0;\n";
	Blockly.smartAgri.function_["function_read_co2_mg811"]+="\treturn v_co2*5000.0;\n";
	Blockly.smartAgri.function_["function_read_co2_mg811"]+="}";


	return["Read_Co2_MG811()",Blockly.smartAgri.ORDER_ATOMIC]
};




//new input sensor windspeed
Blockly.smartAgri.sensor_windspeed_read=function(){
	var pin=this.getFieldValue("PIN");

	Blockly.smartAgri.variable_["variable_read_windspeed"]="int pinWindSpeed = "+pin+";\n";
	Blockly.smartAgri.variable_["variable_read_windspeed"]+="long time_windspeed = 0;\n";
	Blockly.smartAgri.variable_["variable_read_windspeed"]+="unsigned int val_windspeed = 0;";

	Blockly.smartAgri.setups_["setups_read_windspeed"]="\t pinMode(pinWindSpeed, INPUT_PULLUP);\n";
	Blockly.smartAgri.setups_["setups_read_windspeed"]+="\t attachInterrupt(digitalPinToInterrupt(pinWindSpeed),windspeed_interrupt,RISING);";

	Blockly.smartAgri.function_["function_read_windspeed"]="void windspeed_interrupt() {\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="\tif(time_windspeed==0) time_windspeed = millis();\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="\tif(abs(millis()-time_windspeed)>=1000){\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="\t\ttime_windspeed=0;\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="\t\tval_windspeed=0;\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="\t}\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="\tval_windspeed++;\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="}\n";

	Blockly.smartAgri.function_["function_read_windspeed"]+="float Read_WindSpeed() {\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="\tif(val_windspeed>0){\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="\t\tfloat val = (val_windspeed*2.4)/6; //1.492 mph = 1 switch closure/second. or 2.4 km/h\n ";
	Blockly.smartAgri.function_["function_read_windspeed"]+="\t\ttime_windspeed=0;\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="\t\tval_windspeed=0;\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="\t\treturn val;\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="\t}\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="\treturn 0;\n";
	Blockly.smartAgri.function_["function_read_windspeed"]+="}";

	return["Read_WindSpeed()",Blockly.smartAgri.ORDER_ATOMIC]
};

//new input sensor raingauge
Blockly.smartAgri.sensor_raingauge_read=function(){
	var pin=this.getFieldValue("PIN");

	Blockly.smartAgri.variable_["variable_read_raingauge"]="int pinRainGauge = "+pin+";\n";
	Blockly.smartAgri.variable_["variable_read_raingauge"]+="long time_raingauge = 0;\n";
	Blockly.smartAgri.variable_["variable_read_raingauge"]+="unsigned int val_raingauge = 0;";

	Blockly.smartAgri.setups_["setups_read_raingauge"]="\t pinMode(pinRainGauge, INPUT_PULLUP);\n";
	Blockly.smartAgri.setups_["setups_read_raingauge"]+="\t attachInterrupt(digitalPinToInterrupt(pinRainGauge),raingauge_interrupt,RISING);";

	Blockly.smartAgri.function_["function_read_raingauge"]="void raingauge_interrupt() {\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="\tif(time_raingauge==0) time_raingauge = millis();\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="\tif(abs(millis()-time_raingauge)>=1000){\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="\t\ttime_raingauge=0;\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="\t\tval_raingauge=0;\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="\t}\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="\tval_raingauge++;\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="}\n";

	Blockly.smartAgri.function_["function_read_raingauge"]+="float Read_RainGauge() {\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="\tif(val_raingauge>0){\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="\t\tfloat val = (val_raingauge*0.2794); //This means that for each 0.011\" (0.2794 mm) of rain that falls in the sensor\n ";
	Blockly.smartAgri.function_["function_read_raingauge"]+="\t\ttime_raingauge=0;\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="\t\tval_raingauge=0;\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="\t\treturn val;\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="\t}\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="\treturn 0;\n";
	Blockly.smartAgri.function_["function_read_raingauge"]+="}";

	return["Read_RainGauge()",Blockly.smartAgri.ORDER_ATOMIC]
};

//new input sensor windvane
Blockly.smartAgri.sensor_windvane_read=function(){
	var pin=this.getFieldValue("PIN");
	var type=this.getFieldValue("TYPE");

	Blockly.smartAgri.include_["include_library_adc"]="#include <MCP3208.h>// chip for ADC pin 0-7\n";
	Blockly.smartAgri.include_["include_library_adc"]+="MCP3208 adc(10); // control pin";

	Blockly.smartAgri.setups_["setup_library_adc"]="\tadc.begin();// ประกาศใช้ ADC";

	Blockly.smartAgri.function_["function_read_windvane"]="int Read_WindVane(){\n";
  	Blockly.smartAgri.function_["function_read_windvane"]+="\tint  val = adc.analogRead(0);\n";
	Blockly.smartAgri.function_["function_read_windvane"]+="\tint drange = 100; // distance range \n";
	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=2850-drange && val<=2850+drange) return 0; // N direction\n";
	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=1700-(drange+50) && val<=1700+(drange+50)) return 1; // NE direction\n";
	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=370-drange && val<=370+drange) return 2; // E direction\n";
	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=705-(drange+50) && val<=705+(drange+50))return 3; // SE direction\n";
 	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=1070-drange && val<=1070+drange) return 4; // S direction\n";
	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=2290-(drange+50) && val<=2290+(drange+50)) return 5; // SW direction\n";
	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=3400-drange && val<=3400+drange) return 6; // W direction\n";
	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=3200-(drange+50) && val<=3200+(drange+50)) return 7; // NW direction\n";
	Blockly.smartAgri.function_["function_read_windvane"]+="\treturn -1;\n";
	Blockly.smartAgri.function_["function_read_windvane"]+="}\n";
	Blockly.smartAgri.function_["function_read_windvane"]+="String ReadString_WindVane(){\n";
  	Blockly.smartAgri.function_["function_read_windvane"]+="\tint  val = adc.analogRead(0);\n";
  	Blockly.smartAgri.function_["function_read_windvane"]+="\tint drange = 100; // distance range \n";
  	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=2850-drange && val<=2850+drange) return \"N\"; // N direction\n";
  	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=1700-(drange+50) && val<=1700+(drange+50)) return \"NE\"; // NE direction\n";
  	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=370-drange && val<=370+drange) return \"E\"; // E direction\n";
  	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=705-(drange+50) && val<=705+(drange+50))return \"SE\"; // SE direction\n";
  	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=1070-drange && val<=1070+drange) return \"S\"; // S direction\n";
  	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=2290-(drange+50) && val<=2290+(drange+50)) return \"SW\"; // SW direction\n";
  	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=3400-drange && val<=3400+drange) return \"W\"; // W direction\n";
  	Blockly.smartAgri.function_["function_read_windvane"]+="\tif(val>=3200-(drange+50) && val<=3200+(drange+50)) return \"NW\"; // NW direction\n";
  	Blockly.smartAgri.function_["function_read_windvane"]+="\treturn \"nane\";\n";
	Blockly.smartAgri.function_["function_read_windvane"]+="}";

	if(type==0){
		return["ReadString_WindVane()",Blockly.smartAgri.ORDER_ATOMIC]
	}
	else
	{
		return["Read_WindVane()",Blockly.smartAgri.ORDER_ATOMIC]
	}

	return["Read_WindVane()",Blockly.smartAgri.ORDER_ATOMIC]
};


//new input sensor TDS
Blockly.smartAgri.sensor_tds_read=function(){
	var pin=this.getFieldValue("PIN");

	Blockly.smartAgri.include_["include_library_adc"]="#include <MCP3208.h>// chip for ADC pin 0-7\n";
	Blockly.smartAgri.include_["include_library_adc"]+="MCP3208 adc(10); // control pin";

	Blockly.smartAgri.setups_["setup_library_adc"]="\tadc.begin();// ประกาศใช้ ADC";

	Blockly.smartAgri.include_["include_library_TDS"]="#define VREF 5.0 // nalog reference voltage(Volt) of the ADC \n";
	Blockly.smartAgri.include_["include_library_TDS"]+="#define SCOUNT 30 //sum of sample point\n";
	Blockly.smartAgri.include_["include_library_TDS"]+="int analogBuffer[SCOUNT]; //store the analog value in the array, read from ADC\n";
	Blockly.smartAgri.include_["include_library_TDS"]+="int analogBufferTemp[SCOUNT];\n";
	Blockly.smartAgri.include_["include_library_TDS"]+="int analogBufferIndex = 0,copyIndex = 0;\n";
	Blockly.smartAgri.include_["include_library_TDS"]+="float averageVoltage = 0,tdsValue = 0,temperature = 25;";

	Blockly.smartAgri.function_["function_read_TDS"]="float Read_TDS_Value() {\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\tstatic unsigned long analogSampleTimepoint = millis();\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\tif(millis()-analogSampleTimepoint > 40U){     //every 40 milliseconds,read the analog value from the ADC\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\tanalogSampleTimepoint = millis();\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\tanalogBuffer[analogBufferIndex] = adc.analogRead("+pin+");    //read the analog value and store into the buffer\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\tanalogBufferIndex++;\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\tif(analogBufferIndex == SCOUNT) \n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\tanalogBufferIndex = 0;\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\t} \n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\tstatic unsigned long printTimepoint = millis();\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\tif(millis()-printTimepoint > 800U){\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\t\tprintTimepoint = millis();\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\t\tfor(copyIndex=0;copyIndex<SCOUNT;copyIndex++)\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\t\tanalogBufferTemp[copyIndex]= analogBuffer[copyIndex];\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\t\taverageVoltage = getMedianNum(analogBufferTemp,SCOUNT) * (float)VREF / 4095.0; // read the analog value more stable by the median filtering algorithm, and convert to voltage value\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\t\tfloat compensationCoefficient=1.0+0.02*(temperature-25.0);    //temperature compensation formula: fFinalResult(25^C) = fFinalResult(current)/(1.0+0.02*(fTP-25.0));\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\t\tfloat compensationVolatge=averageVoltage/compensationCoefficient;  //temperature compensation\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\t\ttdsValue=(133.42*compensationVolatge*compensationVolatge*compensationVolatge - 255.86*compensationVolatge*compensationVolatge + 857.39*compensationVolatge)*0.5; //convert voltage value to tds value\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\t\treturn tdsValue;\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\t}\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="\treturn tdsValue;\n";
	Blockly.smartAgri.function_["function_read_TDS"]+="}";

	Blockly.smartAgri.function_["function_getMedianNum"]="int getMedianNum(int bArray[], int iFilterLen){\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\tint bTab[iFilterLen];\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\tfor (byte i = 0; i<iFilterLen; i++)\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\t\tbTab[i] = bArray[i];\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\tint i, j, bTemp;\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\tfor (j = 0; j < iFilterLen - 1; j++){\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\tfor (i = 0; i < iFilterLen - j - 1; i++) {\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\tif (bTab[i] > bTab[i + 1]) {\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\t\tbTemp = bTab[i];\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\t\tbTab[i] = bTab[i + 1];\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\t\tbTab[i + 1] = bTemp;\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\t}}}\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\tif ((iFilterLen & 1) > 0)\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\t\tbTemp = bTab[(iFilterLen - 1) / 2];\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\telse\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\t\tbTemp = (bTab[iFilterLen / 2] + bTab[iFilterLen / 2 - 1]) / 2;\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="\treturn bTemp;\n";
	Blockly.smartAgri.function_["function_getMedianNum"]+="}";

	return["Read_TDS_Value()",Blockly.smartAgri.ORDER_ATOMIC]
};

//new input sensor DS18B20
Blockly.smartAgri.sensor_ds18b20_read=function(){
	var pin=this.getFieldValue("PIN");
	var type=this.getFieldValue("TYPE");
	Blockly.smartAgri.include_["include_library_Wire"]="#include <Wire.h>";
	Blockly.smartAgri.include_["include_library_DallasTemperature"]="#include <DallasTemperature.h>";
	Blockly.smartAgri.include_["include_library_OneWire"]="#include <OneWire.h>";
	Blockly.smartAgri.include_["include_library_DS18B20"]="OneWire oneWire("+pin+");\n";
	Blockly.smartAgri.include_["include_library_DS18B20"]+="DallasTemperature DS18B20(&oneWire);";
	Blockly.smartAgri.setups_["setup_DS18B20"]="\tDS18B20.begin();";
	Blockly.smartAgri.inloop_["inloop_DS18B20"]="\tDS18B20.requestTemperatures();\n";
	if(type==0)
	{
		return["DS18B20.getTempCByIndex(0)",Blockly.smartAgri.ORDER_ATOMIC]
	}
	else
	{
		return["DS18B20.toFahrenheit(DS18B20.getTempCByIndex(0))",Blockly.smartAgri.ORDER_ATOMIC]
	}
	return["DS18B20.getTempCByIndex(0)",Blockly.smartAgri.ORDER_ATOMIC]
};




//new input sensor Water Level Liquid
Blockly.smartAgri.sensor_water_level_liquid=function(){
	var pin=this.getFieldValue("PIN");
	var type=this.getFieldValue("TYPE");

	Blockly.smartAgri.setups_["setup_input_"+pin]="pinMode("+pin+", INPUT_PULLUP);";

	Blockly.smartAgri.function_["function_read_water_level_liquid"]="int Read_Water_Level_Liquid(int active=LOW) {\n";
	Blockly.smartAgri.function_["function_read_water_level_liquid"]+="\tint result = digitalRead(2);\n";
	Blockly.smartAgri.function_["function_read_water_level_liquid"]+="\tif(active==LOW) {\n";
	Blockly.smartAgri.function_["function_read_water_level_liquid"]+="\t\tif(result==LOW) return HIGH; else return LOW;\n";
	Blockly.smartAgri.function_["function_read_water_level_liquid"]+="\t}\n";
	Blockly.smartAgri.function_["function_read_water_level_liquid"]+="\tif(active==HIGH) {\n";
	Blockly.smartAgri.function_["function_read_water_level_liquid"]+="\t\tif(result==LOW) return LOW; else return HIGH;\n";
	Blockly.smartAgri.function_["function_read_water_level_liquid"]+="\t}\n";
	Blockly.smartAgri.function_["function_read_water_level_liquid"]+="\treturn -1;\n";
	Blockly.smartAgri.function_["function_read_water_level_liquid"]+="}";

	var stype = "";
	type==1? stype="HIGH":stype="LOW";
	return["Read_Water_Level_Liquid("+stype+")",Blockly.smartAgri.ORDER_ATOMIC]
};

var global_LCD_Address = "0x3C";
var global_LCD_COL = "16";
var global_LCD_ROW = "2";

//new display LCD setaddress
Blockly.smartAgri.display_lcd_setaddress=function(){
	var address=this.getFieldValue("ADDRESS");
	var col=this.getFieldValue("COL");
	var row=this.getFieldValue("ROW");

	global_LCD_Address = address;
	global_LCD_COL = col;
	global_LCD_ROW = row;

	Blockly.smartAgri.include_["include_library_Wire"]="#include <Wire.h>";
	Blockly.smartAgri.include_["include_library_LCD"]="#include <LiquidCrystal_I2C.h> //ประกาศ Library ของจอ I2C\n";
	Blockly.smartAgri.include_["include_library_LCD"]+="LiquidCrystal_I2C lcd("+global_LCD_Address+", "+global_LCD_COL+", "+global_LCD_ROW+");// SetLCD address to "+global_LCD_Address+" for a "+global_LCD_COL+" chars and "+global_LCD_ROW+" line display";

	Blockly.smartAgri.setups_["setup_lcd_begin"]="\tlcd.begin();\n";
	Blockly.smartAgri.setups_["setup_lcd_begin"]+="\tlcd.print(\"Hello !!!\");//ฟังก์ชั่นในการกำหนดข้อความที่ต้องการแสดงผล\n";
	Blockly.smartAgri.setups_["setup_lcd_begin"]+="\tlcd.setCursor(0, 1);//ฟังก์ชั่นในการกำหนดตำแหน่ง Cursor\n";
	Blockly.smartAgri.setups_["setup_lcd_begin"]+="\tlcd.print(\"smart-farm.org\");\n";
	Blockly.smartAgri.setups_["setup_lcd_begin"]+="\tdelay(500);\n";
	Blockly.smartAgri.setups_["setup_lcd_begin"]+="\tlcd.clear();";
	return ""
};

//new display LCD
Blockly.smartAgri.display_lcd=function(){


	var text=Blockly.smartAgri.valueToCode(this,"CONTENT",Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
	var _lcdcol=this.getFieldValue("COL");
	var _lcdrow=this.getFieldValue("ROW");

	Blockly.smartAgri.include_["include_library_Wire"]="#include <Wire.h>";
	Blockly.smartAgri.include_["include_library_LCD"]="#include <LiquidCrystal_I2C.h> //ประกาศ Library ของจอ I2C\n";
	Blockly.smartAgri.include_["include_library_LCD"]+="LiquidCrystal_I2C lcd("+global_LCD_Address+", "+global_LCD_COL+", "+global_LCD_ROW+");// SetLCD address to "+global_LCD_Address+" for a "+global_LCD_COL+" chars and "+global_LCD_ROW+" line display";

	Blockly.smartAgri.setups_["setup_lcd_begin"]="\tlcd.begin();\n";
	Blockly.smartAgri.setups_["setup_lcd_begin"]+="\tlcd.print(\"Hello !!!\");//ฟังก์ชั่นในการกำหนดข้อความที่ต้องการแสดงผล\n";
	Blockly.smartAgri.setups_["setup_lcd_begin"]+="\tlcd.setCursor(0, 1);//ฟังก์ชั่นในการกำหนดตำแหน่ง Cursor\n";
	Blockly.smartAgri.setups_["setup_lcd_begin"]+="\tlcd.print(\"smart-farm.org\");\n";
	Blockly.smartAgri.setups_["setup_lcd_begin"]+="\tdelay(500);\n";
	Blockly.smartAgri.setups_["setup_lcd_begin"]+="\tlcd.clear();";

	var code = "\n";
	code += "lcd.setCursor("+_lcdcol+","+_lcdrow+");\n"
	code += "lcd.print("+text+");\n"
	return code;

};

var global_Max7219_DIN = 4;
var global_Max7219_LOAD = 5;
var global_Max7219_CLK = 6;

//new display sevenseg_max7219 setpin
Blockly.smartAgri.sevenseg_max7219_setpin=function(){
	var _DIN=this.getFieldValue("DIN");
	var _LOAD=this.getFieldValue("LOAD");
	var _CLK=this.getFieldValue("CLK");
	
	Blockly.smartAgri.include_["include_library_Wire"]="#include <Wire.h>";
	Blockly.smartAgri.include_["include_library_max7219"]="#include \"MAX7219.h\"\n";
	Blockly.smartAgri.include_["include_library_max7219"]+="MAX7219 mySegDisplay;";

	Blockly.smartAgri.setups_["setup_max7219_setpin"]="\tmySegDisplay.MAX7219_pinSet("+global_Max7219_DIN+","+global_Max7219_CLK+","+
	global_Max7219_LOAD+",1); // DINpin=D"+global_Max7219_DIN+" , CLKpin=D"+global_Max7219_CLK+" , LOADpin=D"+global_Max7219_LOAD+" , numDevice=1";

	Blockly.smartAgri.setups_["setup_max7219_clear"]="\tmySegDisplay.toCLEAR(); // Clear MAX7219 Display";

	global_Max7219_DIN = _DIN;
	global_Max7219_LOAD = _LOAD;
	global_Max7219_CLK = _CLK;
	
	return "";
};
//new display sevenseg_max7219
Blockly.smartAgri.sevenseg_max7219=function(){
	var _value=Blockly.smartAgri.valueToCode(this,"MAX7219_NUM",Blockly.smartAgri.ORDER_ATOMIC)||"0";
	var _digit=this.getFieldValue("DIGIT");

	Blockly.smartAgri.include_["include_library_Wire"]="#include <Wire.h>";
	Blockly.smartAgri.include_["include_library_max7219"]="#include \"MAX7219.h\"\n";
	Blockly.smartAgri.include_["include_library_max7219"]+="MAX7219 mySegDisplay;";

	Blockly.smartAgri.setups_["setup_max7219_setpin"]="mySegDisplay.MAX7219_pinSet("+global_Max7219_DIN+","+global_Max7219_CLK+","+
	global_Max7219_LOAD+",1); // DINpin=D"+global_Max7219_DIN+" , CLKpin=D"+global_Max7219_CLK+" , LOADpin=D"+global_Max7219_LOAD+" , numDevice=1";

	Blockly.smartAgri.setups_["setup_max7219_clear"]="mySegDisplay.toCLEAR(); // Clear MAX7219 Display";
	var code = "";
	code = "mySegDisplay.toPrint("+_digit+","+_value+"); //digit="+_digit+" to number  \n"
	return code;
};
//new display sevenseg_max7219
Blockly.smartAgri.sevenseg_max7219_float=function(){
	var _value=Blockly.smartAgri.valueToCode(this,"MAX7219_NUM",Blockly.smartAgri.ORDER_ATOMIC)||"0";
	var _digit=this.getFieldValue("DIGIT");

	Blockly.smartAgri.include_["include_library_Wire"]="#include <Wire.h>";
	Blockly.smartAgri.include_["include_library_max7219"]="#include \"MAX7219.h\"\n";
	Blockly.smartAgri.include_["include_library_max7219"]+="MAX7219 mySegDisplay;";
	
	Blockly.smartAgri.setups_["setup_max7219_setpin"]="\tmySegDisplay.MAX7219_pinSet("+global_Max7219_DIN+","+global_Max7219_CLK+","+
	global_Max7219_LOAD+",1); // DINpin=D"+global_Max7219_DIN+" , CLKpin=D"+global_Max7219_CLK+" , LOADpin=D"+global_Max7219_LOAD+" , numDevice=1";

	Blockly.smartAgri.setups_["setup_max7219_clear"]="\tmySegDisplay.toCLEAR(); // Clear MAX7219 Display";
	var code = "";
	code = "mySegDisplay.toFPrint("+_digit+","+_value+"); //digit="+_digit+" to number of float  \n"
	return code;
};


//new time rtc years read
Blockly.smartAgri.time_rtc_years_read=function(){

	Blockly.smartAgri.include_["include_library_RTC"]="#include <DS1307.h>\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="DS1307 myRTC; // ประกาศ DS1307 ใช้ชื่อ myRTC\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="RTCDateTime myDateTime;// ประการตัวแปรโครงสร้างให้ RTC";

	Blockly.smartAgri.setups_["setup_library_RTC"]="\tmyRTC.begin();\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\tif (!myRTC.isReady()){// If date not set\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t\tmyRTC.setDateTime(__DATE__, __TIME__); // Set sketch compiling time\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t}";

	Blockly.smartAgri.inloop_["inloop_library_RTC"]="\tmyDateTime = myRTC.getDateTime(); // update time to myDateTime Stucture variables\n";

	return["myDateTime.year",Blockly.smartAgri.ORDER_ATOMIC]
};
//new time rtc months read
Blockly.smartAgri.time_rtc_months_read=function(){
	Blockly.smartAgri.include_["include_library_RTC"]="#include <DS1307.h>\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="DS1307 myRTC; // ประกาศ DS1307 ใช้ชื่อ myRTC\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="RTCDateTime myDateTime;// ประการตัวแปรโครงสร้างให้ RTC";

	Blockly.smartAgri.setups_["setup_library_RTC"]="\tmyRTC.begin();\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\tif (!myRTC.isReady()){// If date not set\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t\tmyRTC.setDateTime(__DATE__, __TIME__); // Set sketch compiling time\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t}";

	Blockly.smartAgri.inloop_["inloop_library_RTC"]="\tmyDateTime = myRTC.getDateTime(); // update time to myDateTime Stucture variables\n";

	return["myDateTime.month",Blockly.smartAgri.ORDER_ATOMIC]
};
//new time rtc days read
Blockly.smartAgri.time_rtc_days_read=function(){
	Blockly.smartAgri.include_["include_library_RTC"]="#include <DS1307.h>\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="DS1307 myRTC; // ประกาศ DS1307 ใช้ชื่อ myRTC\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="RTCDateTime myDateTime;// ประการตัวแปรโครงสร้างให้ RTC";

	Blockly.smartAgri.setups_["setup_library_RTC"]="\tmyRTC.begin();\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\tif (!myRTC.isReady()){// If date not set\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t\tmyRTC.setDateTime(__DATE__, __TIME__); // Set sketch compiling time\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t}";

	Blockly.smartAgri.inloop_["inloop_library_RTC"]="\tmyDateTime = myRTC.getDateTime(); // update time to myDateTime Stucture variables\n";

	return["myDateTime.day",Blockly.smartAgri.ORDER_ATOMIC]
};
//new time rtc hours read
Blockly.smartAgri.time_rtc_hours_read=function(){
	Blockly.smartAgri.include_["include_library_RTC"]="#include <DS1307.h>\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="DS1307 myRTC; // ประกาศ DS1307 ใช้ชื่อ myRTC\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="RTCDateTime myDateTime;// ประการตัวแปรโครงสร้างให้ RTC";

	Blockly.smartAgri.setups_["setup_library_RTC"]="\tmyRTC.begin();\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\tif (!myRTC.isReady()){// If date not set\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t\tmyRTC.setDateTime(__DATE__, __TIME__); // Set sketch compiling time\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t}";

	Blockly.smartAgri.inloop_["inloop_library_RTC"]="\tmyDateTime = myRTC.getDateTime(); // update time to myDateTime Stucture variables\n";

	return["myDateTime.hour",Blockly.smartAgri.ORDER_ATOMIC]
};
//new time rtc mins read
Blockly.smartAgri.time_rtc_mins_read=function(){
	Blockly.smartAgri.include_["include_library_RTC"]="#include <DS1307.h>\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="DS1307 myRTC; // ประกาศ DS1307 ใช้ชื่อ myRTC\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="RTCDateTime myDateTime;// ประการตัวแปรโครงสร้างให้ RTC";

	Blockly.smartAgri.setups_["setup_library_RTC"]="\tmyRTC.begin();\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\tif (!myRTC.isReady()){// If date not set\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t\tmyRTC.setDateTime(__DATE__, __TIME__); // Set sketch compiling time\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t}";

	Blockly.smartAgri.inloop_["inloop_library_RTC"]="\tmyDateTime = myRTC.getDateTime(); // update time to myDateTime Stucture variables\n";

	return["myDateTime.minute",Blockly.smartAgri.ORDER_ATOMIC]
};
//new time rtc seconds read
Blockly.smartAgri.time_rtc_seconds_read=function(){
	Blockly.smartAgri.include_["include_library_RTC"]="#include <DS1307.h>\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="DS1307 myRTC; // ประกาศ DS1307 ใช้ชื่อ myRTC\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="RTCDateTime myDateTime;// ประการตัวแปรโครงสร้างให้ RTC";

	Blockly.smartAgri.setups_["setup_library_RTC"]="\tmyRTC.begin();\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\tif (!myRTC.isReady()){// If date not set\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t\tmyRTC.setDateTime(__DATE__, __TIME__); // Set sketch compiling time\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t}";

	Blockly.smartAgri.inloop_["inloop_library_RTC"]="\tmyDateTime = myRTC.getDateTime(); // update time to myDateTime Stucture variables\n";

	return["myDateTime.second",Blockly.smartAgri.ORDER_ATOMIC]
};
//new time rtc delay
Blockly.smartAgri.time_rtc_seconds_delay=function(){
	var _value=Blockly.smartAgri.valueToCode(this,"Time_RTC_Seconds_Delay",Blockly.smartAgri.ORDER_ATOMIC)||"0";

	Blockly.smartAgri.include_["include_library_RTC"]="#include <DS1307.h>\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="DS1307 myRTC; // ประกาศ DS1307 ใช้ชื่อ myRTC\n";
	Blockly.smartAgri.include_["include_library_RTC"]+="RTCDateTime myDateTime;// ประการตัวแปรโครงสร้างให้ RTC\n";

	Blockly.smartAgri.setups_["setup_library_RTC"]="\tmyRTC.begin();\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\tif (!myRTC.isReady()){// If date not set\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t\tmyRTC.setDateTime(__DATE__, __TIME__); // Set sketch compiling time\n";
	Blockly.smartAgri.setups_["setup_library_RTC"]+="\t}";

	Blockly.smartAgri.variable_["variable_library_RTC"]="int rtc_second_delay = 0;\n";
	Blockly.smartAgri.variable_["variable_library_RTC"]+="int last_time_second = 0;";

	Blockly.smartAgri.function_["function_library_RTC"]="bool Time_RTC_Seconds_Delay(int _time){\n";
	Blockly.smartAgri.function_["function_library_RTC"]+="\tmyDateTime = myRTC.getDateTime(); // update time to myDateTime Stucture variables	\n";
	Blockly.smartAgri.function_["function_library_RTC"]+="\tif(last_time_second!=myDateTime.second) {\n";
	Blockly.smartAgri.function_["function_library_RTC"]+="\t\tif(rtc_second_delay<=1000000) {\n";
	Blockly.smartAgri.function_["function_library_RTC"]+="\t\t\trtc_second_delay ++ ;\n";
	Blockly.smartAgri.function_["function_library_RTC"]+="\t\t}\n";
	Blockly.smartAgri.function_["function_library_RTC"]+="\t\tlast_time_second=myDateTime.second;\n";
	Blockly.smartAgri.function_["function_library_RTC"]+="\t}\n";
	Blockly.smartAgri.function_["function_library_RTC"]+="\tif(rtc_second_delay>=_time) {\n";
	Blockly.smartAgri.function_["function_library_RTC"]+="\t\trtc_second_delay=0;\n";
	Blockly.smartAgri.function_["function_library_RTC"]+="\t\treturn true;\n";
	Blockly.smartAgri.function_["function_library_RTC"]+="\t}\n";
	Blockly.smartAgri.function_["function_library_RTC"]+="\treturn false;\n";
	Blockly.smartAgri.function_["function_library_RTC"]+="}";

	Blockly.smartAgri.inloop_["inloop_library_RTC"]="\tmyDateTime = myRTC.getDateTime(); // update time to myDateTime Stucture variables\n";

	return["Time_RTC_Seconds_Delay("+_value+")",Blockly.smartAgri.ORDER_ATOMIC]
};


Blockly.smartAgri.convert_texttoint=function(){
	var _val = (Blockly.smartAgri.valueToCode(this,"VALUE_IN",Blockly.smartAgri.ORDER_ATOMIC)||"0");

	Blockly.smartAgri.function_["function_convert_texttoint"]="int Convert_TextToInt(String _str){\n";
	Blockly.smartAgri.function_["function_convert_texttoint"]+="\tint result = _str.toInt();\n";
	Blockly.smartAgri.function_["function_convert_texttoint"]+="\treturn result;\n";
	Blockly.smartAgri.function_["function_convert_texttoint"]+="}";


	return["Convert_TextToInt(String("+_val+"))",Blockly.smartAgri.ORDER_ATOMIC]
};
//new add text add text
Blockly.smartAgri.add_text_to_text=function(){
	var text1=Blockly.smartAgri.valueToCode(this,"STRING_TO",Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
	var text2=Blockly.smartAgri.valueToCode(this,"STRING_TO2",Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";

	Blockly.smartAgri.function_["function_string_tostring"]="String Add_StringToString(String str1,String str2){\n";
	Blockly.smartAgri.function_["function_string_tostring"]+="\tString result = String(str1)+String(str2);\n";
	Blockly.smartAgri.function_["function_string_tostring"]+="\treturn result;\n";
	Blockly.smartAgri.function_["function_string_tostring"]+="}";

	return["Add_StringToString(String("+text1+"),String("+text2+"))",Blockly.smartAgri.ORDER_ATOMIC]
};

Blockly.smartAgri.get_text_form_preamble=function(){

	var value_get_pre = Blockly.smartAgri.valueToCode(this, 'GET_PRE',Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
  	var value_get_data = Blockly.smartAgri.valueToCode(this, 'GET_DATA', Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
   	var value_get_end = Blockly.smartAgri.valueToCode(this, 'GET_END', Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";

   	Blockly.smartAgri.function_["function_get_text_form_preamble"]="String getTextFormPreamble(String _Pre,String _Data,String _End){\n";
	Blockly.smartAgri.function_["function_get_text_form_preamble"]+="\tint lenPre = _Pre.length();\n";
	Blockly.smartAgri.function_["function_get_text_form_preamble"]+="\tint lenData = _Data.length();\n";
	Blockly.smartAgri.function_["function_get_text_form_preamble"]+="\tint lenEnd = _End.length();\n";
	Blockly.smartAgri.function_["function_get_text_form_preamble"]+="\tif(_Data.indexOf(_Pre)==0) {\n";
	Blockly.smartAgri.function_["function_get_text_form_preamble"]+="\t\tif(_Data.indexOf(_End)==(lenData-lenEnd) ) {\n";
	Blockly.smartAgri.function_["function_get_text_form_preamble"]+="\t\t\treturn _Data.substring(lenPre,_Data.indexOf(_End));\n";
	Blockly.smartAgri.function_["function_get_text_form_preamble"]+="\t\t}\n";
	Blockly.smartAgri.function_["function_get_text_form_preamble"]+="\t\telse return \"\";\n";
	Blockly.smartAgri.function_["function_get_text_form_preamble"]+="\t}\n";
	Blockly.smartAgri.function_["function_get_text_form_preamble"]+="\telse return \"\";\n";
	Blockly.smartAgri.function_["function_get_text_form_preamble"]+="\treturn \"\";\n";
	Blockly.smartAgri.function_["function_get_text_form_preamble"]+="}";

	return["getTextFormPreamble(String("+value_get_pre+"),String("+value_get_data+"),String("+value_get_end+"))",Blockly.smartAgri.ORDER_ATOMIC]
	
};

Blockly.smartAgri.set_text_form_preamble=function(){

	var value_get_pre = Blockly.smartAgri.valueToCode(this, 'GET_PRE',Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
  	var value_get_data = Blockly.smartAgri.valueToCode(this, 'GET_DATA', Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
   	var value_get_end = Blockly.smartAgri.valueToCode(this, 'GET_END', Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";

   	Blockly.smartAgri.function_["function_set_text_form_preamble"]="String setTextFormPreamble(String _Pre,String _Data,String _End) {\n";
	Blockly.smartAgri.function_["function_set_text_form_preamble"]+="\tString _SumData = _Pre+_Data+_End;\n";
	Blockly.smartAgri.function_["function_set_text_form_preamble"]+="\treturn _SumData;\n";
	Blockly.smartAgri.function_["function_set_text_form_preamble"]+="}";

	return["setTextFormPreamble(String("+value_get_pre+"),String("+value_get_data+"),String("+value_get_end+"))",Blockly.smartAgri.ORDER_ATOMIC]
	
};

var global_ssid = "\"SSID Name\"";
var global_password  = "\"Password\"";

//new add string add string
Blockly.smartAgri.build_nodemcu_module_wifi=function(){
	var ssid = Blockly.smartAgri.valueToCode(this,"SSID",Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
	var password = Blockly.smartAgri.valueToCode(this,"Password",Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";

	global_ssid = ssid;
	global_password = password;

	Blockly.smartAgri.include_["include_library_NodeMCU"]="#include <ESP8266WiFi.h>\n";
	Blockly.smartAgri.include_["include_library_NodeMCU"]+="#include <ESP8266HTTPClient.h>\n";

	Blockly.smartAgri.variable_["variable_NodeMCU"]="const char* ssid     = "+global_ssid+";\n";
	Blockly.smartAgri.variable_["variable_NodeMCU"]+="const char* password = "+global_password+";\n";
	Blockly.smartAgri.variable_["variable_NodeMCU"]+="unsigned int countWiFiReset = 0;";

	Blockly.smartAgri.setups_["setup_NodeMCU"]="\tWiFi.begin(ssid ,password);\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\twhile((WiFi.status() != WL_CONNECTED)){\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t\tdelay(500);\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t\tif(countWiFiReset++>10) ESP.reset();\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t}";


	return ""
};
//new nodemcu_get_https
Blockly.smartAgri.nodemcu_get_https=function(){
	var url=Blockly.smartAgri.valueToCode(this,"URL",Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";

	Blockly.smartAgri.include_["include_library_NodeMCU"]="#include <ESP8266WiFi.h>\n";
	Blockly.smartAgri.include_["include_library_NodeMCU"]+="#include <ESP8266HTTPClient.h>\n";

	Blockly.smartAgri.variable_["variable_NodeMCU"]="const char* ssid     = "+global_ssid+";\n";
	Blockly.smartAgri.variable_["variable_NodeMCU"]+="const char* password = "+global_password+";\n";
	Blockly.smartAgri.variable_["variable_NodeMCU"]+="unsigned int countWiFiReset = 0;";

	Blockly.smartAgri.setups_["setup_NodeMCU"]="\tWiFi.begin(ssid ,password);\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\twhile((WiFi.status() != WL_CONNECTED)){\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t\tdelay(500);\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t\tif(countWiFiReset++>10) ESP.reset();\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t}";

	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]="String GET_HTTPS(String url){\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\tif(WiFi.status() == WL_CONNECTED){\n";
  	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\tHTTPClient http;\n";
  	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\thttp.begin(url); //HTTPS\n";
  	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\tint httpCode = http.GET();\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\tif(httpCode > 0) {\n";             
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\t\tif(httpCode == HTTP_CODE_OK) {\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\t\t\tString payload = http.getString();\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\t\t\treturn payload;\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\t\t\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\t\t\telse\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\t\t\t{\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\t\t\treturn \"failed\";\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\t\t\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\t\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\telse\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\t{\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\t\treturn \"HTTP failed\";\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t\thttp.end();\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_GetHttp"]+="}";

	return["GET_HTTPS("+url+")",Blockly.smartAgri.ORDER_ATOMIC]
};

Blockly.smartAgri.nodemcu_get_lastfield_thingspeak=function(){
	var value_channel = Blockly.smartAgri.valueToCode(this, 'CHANNEL', Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
  	var value_atfield = Blockly.smartAgri.valueToCode(this, 'ATFIELD', Blockly.smartAgri.ORDER_ATOMIC)||"1";

  	Blockly.smartAgri.include_["include_library_NodeMCU"]="#include <ESP8266WiFi.h>\n";
	Blockly.smartAgri.include_["include_library_NodeMCU"]+="#include <ESP8266HTTPClient.h>\n";

	Blockly.smartAgri.variable_["variable_NodeMCU"]="const char* ssid     = "+global_ssid+";\n";
	Blockly.smartAgri.variable_["variable_NodeMCU"]+="const char* password = "+global_password+";\n";
	Blockly.smartAgri.variable_["variable_NodeMCU"]+="unsigned int countWiFiReset = 0;";

	Blockly.smartAgri.setups_["setup_NodeMCU"]="\tWiFi.begin(ssid ,password);\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\twhile((WiFi.status() != WL_CONNECTED)){\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t\tdelay(500);\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t\tif(countWiFiReset++>10) ESP.reset();\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t}";

	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]="String getLastFieldFromThingSpeak(String _Channel,String _Field){\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\tString _Url = \"http://api.thingspeak.com/channels/\"+_Channel+\"/fields/\"+_Field+\"/last\";\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\tif(WiFi.status() == WL_CONNECTED){\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\t\tHTTPClient http;\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\t\thttp.begin(_Url);\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\t\tint httpCode = http.GET();\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\t\tif(httpCode > 0){ \n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\t\t\tif(httpCode == HTTP_CODE_OK){\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\t\t\t\tString payload = http.getString();\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\t\t\t\treturn payload;\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\t\t\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\t\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\t\thttp.end();\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="\treturn \"\";\n";
	Blockly.smartAgri.function_["function_NodeMCU_get_lastfield"]+="}";

	return["getLastFieldFromThingSpeak("+value_channel+",String("+value_atfield+"))",Blockly.smartAgri.ORDER_ATOMIC]
};


//new nodemcu_up_thingspeak
Blockly.smartAgri.nodemcu_up_thingspeak=function(){
	var value_api_key = Blockly.smartAgri.valueToCode(this, 'API_KEY', Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
  	var value_set_field = Blockly.smartAgri.valueToCode(this, 'SET_FIELD', Blockly.smartAgri.ORDER_ATOMIC)||1;
  	var value_data_field = Blockly.smartAgri.valueToCode(this, 'DATA_FIELD', Blockly.smartAgri.ORDER_ATOMIC)||0;

  	Blockly.smartAgri.include_["include_library_NodeMCU"]="#include <ESP8266WiFi.h>\n";
	Blockly.smartAgri.include_["include_library_NodeMCU"]+="#include <ESP8266HTTPClient.h>\n";

	Blockly.smartAgri.variable_["variable_NodeMCU"]="const char* ssid     = "+global_ssid+";\n";
	Blockly.smartAgri.variable_["variable_NodeMCU"]+="const char* password = "+global_password+";\n";
	Blockly.smartAgri.variable_["variable_NodeMCU"]+="unsigned int countWiFiReset = 0;";

	Blockly.smartAgri.setups_["setup_NodeMCU"]="\tWiFi.begin(ssid ,password);\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\twhile((WiFi.status() != WL_CONNECTED)){\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t\tdelay(500);\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t\tif(countWiFiReset++>10) ESP.reset();\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t}";

  	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]="void UP_THINGSPEAK(String api_key,String atfield,String data) {\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\tif(WiFi.status() == WL_CONNECTED){\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\tWiFiClient client; //เรียกใช้การเชื่อมต่อกับ Wi-Fi \n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\tchar thingSpeakAddress[] = \"api.thingspeak.com\";\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\tString _getData = \"&field\"+atfield+\"=\"+data;\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\tif(client.connect(thingSpeakAddress, 80)) {\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"POST /update HTTP/1.1\\n\"); //การส่งค่าข้อมูลผ่าน HTTP\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"Host: api.thingspeak.com\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"Connection: close\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"X-THINGSPEAKAPIKEY: \" + api_key + \"\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"Content-Type: application/x-www-form-urlencoded\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"Content-Length: \");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(_getData.length());\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"\\n\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(_getData); //path ข้อมูลที่เราจะส่งค่าไปยัง ThingSpeak\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="}";

	return "UP_THINGSPEAK("+value_api_key+",String("+value_set_field+"),String("+value_data_field+"));\n"
};
//new nodemcu_up_thingspeak2
Blockly.smartAgri.nodemcu_up_thingspeak2=function(){
	var value_api_key = Blockly.smartAgri.valueToCode(this, 'API_KEY', Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
  	var value_data_field1 = Blockly.smartAgri.valueToCode(this, 'DATA_FIELD1', Blockly.smartAgri.ORDER_ATOMIC)||0;
  	var value_data_field2 = Blockly.smartAgri.valueToCode(this, 'DATA_FIELD2', Blockly.smartAgri.ORDER_ATOMIC)||0;

  	Blockly.smartAgri.include_["include_library_NodeMCU"]="#include <ESP8266WiFi.h>\n";
	Blockly.smartAgri.include_["include_library_NodeMCU"]+="#include <ESP8266HTTPClient.h>\n";

	Blockly.smartAgri.variable_["variable_NodeMCU"]="const char* ssid     = "+global_ssid+";\n";
	Blockly.smartAgri.variable_["variable_NodeMCU"]+="const char* password = "+global_password+";\n";
	Blockly.smartAgri.variable_["variable_NodeMCU"]+="unsigned int countWiFiReset = 0;";

	Blockly.smartAgri.setups_["setup_NodeMCU"]="\tWiFi.begin(ssid ,password);\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\twhile((WiFi.status() != WL_CONNECTED)){\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t\tdelay(500);\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t\tif(countWiFiReset++>10) ESP.reset();\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t}";

  	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]="void UP_THINGSPEAK2(String api_key,String field1,String field2) {\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\tif(WiFi.status() == WL_CONNECTED){\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\tWiFiClient client; //เรียกใช้การเชื่อมต่อกับ Wi-Fi \n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\tchar thingSpeakAddress[] = \"api.thingspeak.com\";\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\tString _getData = \"&field1=\"+field1+\"&field2=\"+field2;\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\tif(client.connect(thingSpeakAddress, 80)) {\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"POST /update HTTP/1.1\\n\"); //การส่งค่าข้อมูลผ่าน HTTP\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"Host: api.thingspeak.com\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"Connection: close\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"X-THINGSPEAKAPIKEY: \" + api_key + \"\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"Content-Type: application/x-www-form-urlencoded\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"Content-Length: \");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(_getData.length());\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"\\n\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(_getData); //path ข้อมูลที่เราจะส่งค่าไปยัง ThingSpeak\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="}";

	return "UP_THINGSPEAK2("+value_api_key+",String("+value_data_field1+"),String("+value_data_field2+"));\n"
};
//new nodemcu_up_thingspeak2
Blockly.smartAgri.nodemcu_up_thingspeak4=function(){
	var value_api_key = Blockly.smartAgri.valueToCode(this, 'API_KEY', Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
  	var value_data_field1 = Blockly.smartAgri.valueToCode(this, 'DATA_FIELD1', Blockly.smartAgri.ORDER_ATOMIC)||0;
  	var value_data_field2 = Blockly.smartAgri.valueToCode(this, 'DATA_FIELD2', Blockly.smartAgri.ORDER_ATOMIC)||0;
  	var value_data_field3 = Blockly.smartAgri.valueToCode(this, 'DATA_FIELD3', Blockly.smartAgri.ORDER_ATOMIC)||0;
  	var value_data_field4 = Blockly.smartAgri.valueToCode(this, 'DATA_FIELD4', Blockly.smartAgri.ORDER_ATOMIC)||0;

  	Blockly.smartAgri.include_["include_library_NodeMCU"]="#include <ESP8266WiFi.h>\n";
	Blockly.smartAgri.include_["include_library_NodeMCU"]+="#include <ESP8266HTTPClient.h>\n";

	Blockly.smartAgri.variable_["variable_NodeMCU"]="const char* ssid     = "+global_ssid+";\n";
	Blockly.smartAgri.variable_["variable_NodeMCU"]+="const char* password = "+global_password+";\n";
	Blockly.smartAgri.variable_["variable_NodeMCU"]+="unsigned int countWiFiReset = 0;";

	Blockly.smartAgri.setups_["setup_NodeMCU"]="\tWiFi.begin(ssid ,password);\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\twhile((WiFi.status() != WL_CONNECTED)){\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t\tdelay(500);\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t\tif(countWiFiReset++>10) ESP.reset();\n";
	Blockly.smartAgri.setups_["setup_NodeMCU"]+="\t}";

  	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]="void UP_THINGSPEAK4(String api_key,String field1,String field2,String field3,String field4) {\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\tif(WiFi.status() == WL_CONNECTED){\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\tWiFiClient client; //เรียกใช้การเชื่อมต่อกับ Wi-Fi \n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\tchar thingSpeakAddress[] = \"api.thingspeak.com\";\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\tString _getData = \"&field1=\"+field1+\"&field2=\"+field2+\"&field3=\"+field3+\"&field4=\"+field4;\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\tif(client.connect(thingSpeakAddress, 80)) {\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"POST /update HTTP/1.1\\n\"); //การส่งค่าข้อมูลผ่าน HTTP\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"Host: api.thingspeak.com\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"Connection: close\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"X-THINGSPEAKAPIKEY: \" + api_key + \"\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"Content-Type: application/x-www-form-urlencoded\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"Content-Length: \");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(_getData.length());\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(\"\\n\\n\");\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t\tclient.print(_getData); //path ข้อมูลที่เราจะส่งค่าไปยัง ThingSpeak\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="\t}\n";
	Blockly.smartAgri.function_["function_NodeMCU_UpdateToThingSpeak"]+="}";

	return["UP_THINGSPEAK4("+value_api_key+",String("+value_data_field1+"),String("+value_data_field2+"),String("+value_data_field3+"),String("+value_data_field4+"));\n",Blockly.smartAgri.ORDER_ATOMIC]
};

var global_ch = 90;
var global_Rxaddress = "SMFARM";
var global_Txaddress = "SMFARM";

Blockly.smartAgri.build_nrf24l01=function(){

	var ch = Blockly.smartAgri.valueToCode(this,"CH",Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
	var Rxaddress = Blockly.smartAgri.valueToCode(this,"RXADDRESS",Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
	var Txaddress = Blockly.smartAgri.valueToCode(this,"TXADDRESS",Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";
	global_ch = ch;
	global_Rxaddress = Rxaddress;
	global_Txaddress = Txaddress;

	Blockly.smartAgri.include_["include_library_NRF24L01"]="#include <SPI.h>\n";
	Blockly.smartAgri.include_["include_library_NRF24L01"]+="#include <nRF24L01p.h>\n";
	Blockly.smartAgri.include_["include_library_NRF24L01"]+="nRF24L01p nRf(7,8);//CSN,CE\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]="\tSPI.begin();\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tSPI.setBitOrder(MSBFIRST);\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tnRf.channel("+global_ch+");\n";
	global_Rxaddress = global_Rxaddress.substring(1, 6);
	global_Txaddress = global_Txaddress.substring(1, 6);
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tnRf.RXaddress("+global_Rxaddress+");\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tnRf.TXaddress("+global_Txaddress+");\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tnRf.init();";

	return ""
};
//new nrf24l01 read
Blockly.smartAgri.nrf24l01_read=function(){

	Blockly.smartAgri.include_["include_library_NRF24L01"]="#include <SPI.h>\n";
	Blockly.smartAgri.include_["include_library_NRF24L01"]+="#include <nRF24L01p.h>\n";
	Blockly.smartAgri.include_["include_library_NRF24L01"]+="nRF24L01p nRf(7,8);//CSN,CE\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]="\tSPI.begin();\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tSPI.setBitOrder(MSBFIRST);\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tnRf.channel("+global_ch+");\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tnRf.RXaddress(\""+global_Rxaddress+"\");\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tnRf.TXaddress(\""+global_Txaddress+"\");\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tnRf.init();";

	Blockly.smartAgri.function_["function_Read_NRF"]="String function_Read_NRF(){\n";
	Blockly.smartAgri.function_["function_Read_NRF"]+="\tString message = \"\";\n";
	Blockly.smartAgri.function_["function_Read_NRF"]+="\tint count = 0;\n";
	Blockly.smartAgri.function_["function_Read_NRF"]+="\twhile(count<10){\n";   
	Blockly.smartAgri.function_["function_Read_NRF"]+="\t\tif(nRf.available()){\n";
	Blockly.smartAgri.function_["function_Read_NRF"]+="\t\t\tnRf.read();\n"; 
	Blockly.smartAgri.function_["function_Read_NRF"]+="\t\t\tnRf.rxPL(message);\n";
	Blockly.smartAgri.function_["function_Read_NRF"]+="\t\t\tmessage.replace(\"\",\"\\n\");\n"; 
    Blockly.smartAgri.function_["function_Read_NRF"]+="\t\t\tmessage.replace(\"\",\"\\r\");\n";
	Blockly.smartAgri.function_["function_Read_NRF"]+="\t\t\tif(message!=\"\") break;\n"; 
	Blockly.smartAgri.function_["function_Read_NRF"]+="\t\t}\n";
	Blockly.smartAgri.function_["function_Read_NRF"]+="\t\tdelay(100);\n";   
	Blockly.smartAgri.function_["function_Read_NRF"]+="\t\tcount++;\n"; 
	Blockly.smartAgri.function_["function_Read_NRF"]+="\t}\n"; 
	Blockly.smartAgri.function_["function_Read_NRF"]+="\treturn message;\n"; 
	Blockly.smartAgri.function_["function_Read_NRF"]+="}\n";   

	return ["function_Read_NRF()",Blockly.smartAgri.ORDER_ATOMIC]
};
//new nrf24l01 write
Blockly.smartAgri.nrf24l01_send=function(){

	var text=Blockly.smartAgri.valueToCode(this,"SEND_RF",Blockly.smartAgri.ORDER_ATOMIC)||"\"\"";

	Blockly.smartAgri.include_["include_library_NRF24L01"]="#include <SPI.h>\n";
	Blockly.smartAgri.include_["include_library_NRF24L01"]+="#include <nRF24L01p.h>\n";
	Blockly.smartAgri.include_["include_library_NRF24L01"]+="nRF24L01p nRf(7,8);//CSN,CE\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]="\tSPI.begin();\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tSPI.setBitOrder(MSBFIRST);\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tnRf.channel("+global_ch+");\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tnRf.RXaddress(\""+global_Rxaddress+"\");\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tnRf.TXaddress(\""+global_Txaddress+"\");\n";
	Blockly.smartAgri.setups_["setup_NRF24L01"]+="\tnRf.init();";

	Blockly.smartAgri.function_["function_Send_NRF"]="void function_Send_NRF(String _message){\n";
	Blockly.smartAgri.function_["function_Send_NRF"]+="\tnRf.txPL(_message); \n";
	Blockly.smartAgri.function_["function_Send_NRF"]+="\tnRf.send(FAST);\n";
	Blockly.smartAgri.function_["function_Send_NRF"]+="}";

	return "function_Send_NRF("+text+");\n"
};

//new serial print
Blockly.smartAgri.set_serial_port=function(){

	var dropdown_baudrate = this.getFieldValue('BAUDRATE');

	GlobalVariableBaudRate = dropdown_baudrate;

	Blockly.smartAgri.setups_["setup_serial_baudrate"]="\tSerial.begin("+GlobalVariableBaudRate+");";

	return ""
};

//new serial print
Blockly.smartAgri.serial_print=function(){
	var text=Blockly.smartAgri.valueToCode(this,"CONTENT",Blockly.smartAgri.ORDER_ATOMIC)||"";
	Blockly.smartAgri.setups_["setup_serial_baudrate"]="\tSerial.begin("+GlobalVariableBaudRate+");";
	return"Serial.print("+text+");\n"
};
//new serial print type
Blockly.smartAgri.serial_print_type=function(){
	var text=Blockly.smartAgri.valueToCode(this,"CONTENT",Blockly.smartAgri.ORDER_ATOMIC)||"";
	var type=this.getFieldValue("TYPE_PRINT");

	Blockly.smartAgri.setups_["setup_serial_baudrate"]="\tSerial.begin("+GlobalVariableBaudRate+");";

	return"Serial.print("+text+","+type+");\n"
};
//new serial print new line
Blockly.smartAgri.serial_println=function(){
	var text=Blockly.smartAgri.valueToCode(this,"CONTENT",Blockly.smartAgri.ORDER_ATOMIC)||"";
	Blockly.smartAgri.setups_["setup_serial_baudrate"]="\tSerial.begin("+GlobalVariableBaudRate+");";
	return"Serial.println("+text+");\n"
};

//new serial print new line type
Blockly.smartAgri.serial_println_type=function(){
	var text=Blockly.smartAgri.valueToCode(this,"CONTENT",Blockly.smartAgri.ORDER_ATOMIC)||"";
	var type=this.getFieldValue("TYPE_PRINT");
	Blockly.smartAgri.setups_["setup_serial_baudrate"]="\tSerial.begin("+GlobalVariableBaudRate+");";
	return"Serial.println("+text+","+type+");\n"
};



Blockly.smartAgri.read_uart=function(){
	
	Blockly.smartAgri.setups_["setup_serial_baudrate"]="\tSerial.begin("+GlobalVariableBaudRate+");";

	Blockly.smartAgri.variable_["variable_getDataFromUART"]="String getDataFromUART = \"\";\n";

	Blockly.smartAgri.function_["function_Read_UART"]="String function_Read_UART(){ \n";
	Blockly.smartAgri.function_["function_Read_UART"]+="\tif(!Serial.available()) return getDataFromUART;\n";
	Blockly.smartAgri.function_["function_Read_UART"]+="\tgetDataFromUART=\"\";\n";
	Blockly.smartAgri.function_["function_Read_UART"]+="\twhile(Serial.available()>0){\n";
	Blockly.smartAgri.function_["function_Read_UART"]+="\t\tchar reads = Serial.read();\n";
	Blockly.smartAgri.function_["function_Read_UART"]+="\t\tgetDataFromUART += reads;\n";  
	Blockly.smartAgri.function_["function_Read_UART"]+="\t}\n"; 
	Blockly.smartAgri.function_["function_Read_UART"]+="\treturn getDataFromUART;\n"; 
	Blockly.smartAgri.function_["function_Read_UART"]+="}";    

	return["function_Read_UART()",Blockly.smartAgri.ORDER_ATOMIC]
};
//new send uart
Blockly.smartAgri.send_uart=function(){
	var text=Blockly.smartAgri.valueToCode(this,"SEND_UART",Blockly.smartAgri.ORDER_ATOMIC)||"";
	Blockly.smartAgri.setups_["setup_serial_baudrate"]="\tSerial.begin("+GlobalVariableBaudRate+");";
	Blockly.smartAgri.function_["function_Send_UART"]="void function_Write_UART(String text){\n";
	Blockly.smartAgri.function_["function_Send_UART"]+="\tString _text = String(text);\n";
	Blockly.smartAgri.function_["function_Send_UART"]+="\tfor(int i=0;i<_text.length();i++)\n";
	Blockly.smartAgri.function_["function_Send_UART"]+="\t{\n";
	Blockly.smartAgri.function_["function_Send_UART"]+="\t\tSerial.write(_text[i]);\n";
	Blockly.smartAgri.function_["function_Send_UART"]+="\t}\n";
	Blockly.smartAgri.function_["function_Send_UART"]+="}";
	return"function_Write_UART("+text+");\n"
};

//new send uart
Blockly.smartAgri.send_uart_newline=function(){
	var text=Blockly.smartAgri.valueToCode(this,"SEND_UART_NEWLINE",Blockly.smartAgri.ORDER_ATOMIC)||"";
	Blockly.smartAgri.setups_["setup_serial_baudrate"]="\tSerial.begin("+GlobalVariableBaudRate+");";
	Blockly.smartAgri.function_["function_Send_UART_newline"]="void function_Write_UART_newline(String text){\n";
	Blockly.smartAgri.function_["function_Send_UART_newline"]+="\tString _text = String(text);\n";
	Blockly.smartAgri.function_["function_Send_UART_newline"]+="\tfor(int i=0;i<_text.length();i++)\n";
	Blockly.smartAgri.function_["function_Send_UART_newline"]+="\t{\n";
	Blockly.smartAgri.function_["function_Send_UART_newline"]+="\t\tSerial.write(_text[i]);\n";
	Blockly.smartAgri.function_["function_Send_UART_newline"]+="\t}\n";
	Blockly.smartAgri.function_["function_Send_UART_newline"]+="\tSerial.write(\'\\n\');\n";
	Blockly.smartAgri.function_["function_Send_UART_newline"]+="\tSerial.write(\'\\r\');\n";
	Blockly.smartAgri.function_["function_Send_UART_newline"]+="}";
	return"function_Write_UART_newline("+text+");\n"
};


//new servo move
Blockly.smartAgri.servo_move=function(){
	var pin=this.getFieldValue("PIN"),val=Blockly.smartAgri.valueToCode(this,"DEGREE",Blockly.smartAgri.ORDER_ATOMIC);
	Blockly.smartAgri.include_["include_Servo"]="#include <Servo.h>\n";
	Blockly.smartAgri.variable_["var_servo_pin_"+pin]="Servo servo_pin_"+pin+";\n";
	Blockly.smartAgri.setups_["setup_servo_pin_"+pin]="servo_pin_"+pin+".attach("+pin+");\n";
	return"servo_pin_"+pin+".write("+val+");\n"
};


//new servo read degrees
Blockly.smartAgri.servo_read_degrees=function(){
	var pin=this.getFieldValue("PIN");
	Blockly.smartAgri.include_["include_Servo"]="#include <Servo.h>\n";
	Blockly.smartAgri.variable_["var_servo_pin_"+pin]="Servo servo_pin_"+pin+";\n";
	Blockly.smartAgri.setups_["setup_servo_pin_"+pin]="servo_pin_"+pin+".attach("+pin+");\n";
	
	return["servo_pin_"+pin+".read()",Blockly.smartAgri.ORDER_ATOMIC]
};
var global_Time_End = 3600;
var global_Set_Function_Timer = "";
// new LowCost PLC Set Timer 
Blockly.smartAgri.Set_Timer=function(){

  	var Time_End = Blockly.smartAgri.valueToCode(this, 'Time_End', Blockly.smartAgri.ORDER_ATOMIC);
  	global_Time_End = Time_End;

	Blockly.smartAgri.include_["include_Set_Timer"]=" ";

	Blockly.smartAgri.variable_["variable_set_Timer_interrupt1_val"]="long Timer_interrupt1_val = 0;\n";
	Blockly.smartAgri.variable_["variable_set_Timer_interrupt1_val"]+="boolean Use_Timer_interrupt1 = false;";

	Blockly.smartAgri.setups_["setup_cli_stop_interrupt"]="\t cli();//stop interrupts";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]="\t //set timer1 interrupt at 1Hz\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1A = 0;// set entire TCCR1A register to 0\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B = 0;// same for TCCR1B\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCNT1  = 0;//initialize counter value to 0\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // set compare match register for 1hz increments\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t OCR1A = 15624;// = (16*10^6) / (1*1024) - 1 (must be <65536)\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // turn on CTC mode\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B |= (1 << WGM12);\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // Set CS12 and CS10 bits for 1024 prescaler\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B |= (1 << CS12) | (1 << CS10);  \n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // enable timer compare interrupt\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TIMSK1 |= (1 << OCIE1A);";
	Blockly.smartAgri.setups_["setup_sei_allow_interrupts"]="\tsei();//allow interrupts\n";

	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]="ISR(TIMER1_COMPA_vect){//timer1 interrupt 1Hz\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="\tif(!Use_Timer_interrupt1 || Timer_interrupt1_val>="+global_Time_End+") return;\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="\tif(Timer_interrupt1_val<"+global_Time_End+") Timer_interrupt1_val++;\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+= global_Set_Function_Timer +"\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="}";

	return "" 
};
// new LowCost PLC Set Function Timer 
Blockly.smartAgri.Set_Function_Timer=function(){
	var statements_timer_loop = Blockly.smartAgri.statementToCode(this, 'Timer_Loop');
	global_Set_Function_Timer = statements_timer_loop;
	//Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="\t"+statements_timer_loop;

	Blockly.smartAgri.variable_["variable_set_Timer_interrupt1_val"]="long Timer_interrupt1_val = 0;\n";
	Blockly.smartAgri.variable_["variable_set_Timer_interrupt1_val"]+="boolean Use_Timer_interrupt1 = false;";

	Blockly.smartAgri.setups_["setup_cli_stop_interrupt"]="\t cli();//stop interrupts";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]="\t //set timer1 interrupt at 1Hz\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1A = 0;// set entire TCCR1A register to 0\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B = 0;// same for TCCR1B\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCNT1  = 0;//initialize counter value to 0\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // set compare match register for 1hz increments\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t OCR1A = 15624;// = (16*10^6) / (1*1024) - 1 (must be <65536)\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // turn on CTC mode\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B |= (1 << WGM12);\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // Set CS12 and CS10 bits for 1024 prescaler\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B |= (1 << CS12) | (1 << CS10);  \n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // enable timer compare interrupt\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TIMSK1 |= (1 << OCIE1A);";
	Blockly.smartAgri.setups_["setup_sei_allow_interrupts"]="\tsei();//allow interrupts\n";

	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]="ISR(TIMER1_COMPA_vect){//timer1 interrupt 1Hz\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="\tif(!Use_Timer_interrupt1 || Timer_interrupt1_val>="+global_Time_End+") return;\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="\tif(Timer_interrupt1_val<"+global_Time_End+") Timer_interrupt1_val++;\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+= global_Set_Function_Timer +"\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="}";

	return ""
}
// new LowCost PLC Timer Reset 
Blockly.smartAgri.Timer_Reset=function(){
	Blockly.smartAgri.variable_["variable_set_Timer_interrupt1_val"]="long Timer_interrupt1_val = 0;\n";
	Blockly.smartAgri.variable_["variable_set_Timer_interrupt1_val"]+="boolean Use_Timer_interrupt1 = false;";

	Blockly.smartAgri.setups_["setup_cli_stop_interrupt"]="\t cli();//stop interrupts";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]="\t //set timer1 interrupt at 1Hz\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1A = 0;// set entire TCCR1A register to 0\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B = 0;// same for TCCR1B\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCNT1  = 0;//initialize counter value to 0\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // set compare match register for 1hz increments\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t OCR1A = 15624;// = (16*10^6) / (1*1024) - 1 (must be <65536)\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // turn on CTC mode\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B |= (1 << WGM12);\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // Set CS12 and CS10 bits for 1024 prescaler\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B |= (1 << CS12) | (1 << CS10);  \n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // enable timer compare interrupt\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TIMSK1 |= (1 << OCIE1A);";
	Blockly.smartAgri.setups_["setup_sei_allow_interrupts"]="\tsei();//allow interrupts\n";

	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]="ISR(TIMER1_COMPA_vect){//timer1 interrupt 1Hz\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="\tif(!Use_Timer_interrupt1 || Timer_interrupt1_val>="+global_Time_End+") return;\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="\tif(Timer_interrupt1_val<"+global_Time_End+") Timer_interrupt1_val++;\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+= global_Set_Function_Timer +"\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="}";
	return "Timer_interrupt1_val=0;\n" 
};
// new LowCost PLC Timer Start 
Blockly.smartAgri.Timer_Start=function(){
	Blockly.smartAgri.variable_["variable_set_Timer_interrupt1_val"]="long Timer_interrupt1_val = 0;\n";
	Blockly.smartAgri.variable_["variable_set_Timer_interrupt1_val"]+="boolean Use_Timer_interrupt1 = false;";

	Blockly.smartAgri.setups_["setup_cli_stop_interrupt"]="\t cli();//stop interrupts";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]="\t //set timer1 interrupt at 1Hz\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1A = 0;// set entire TCCR1A register to 0\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B = 0;// same for TCCR1B\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCNT1  = 0;//initialize counter value to 0\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // set compare match register for 1hz increments\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t OCR1A = 15624;// = (16*10^6) / (1*1024) - 1 (must be <65536)\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // turn on CTC mode\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B |= (1 << WGM12);\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // Set CS12 and CS10 bits for 1024 prescaler\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B |= (1 << CS12) | (1 << CS10);  \n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // enable timer compare interrupt\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TIMSK1 |= (1 << OCIE1A);";
	Blockly.smartAgri.setups_["setup_sei_allow_interrupts"]="\tsei();//allow interrupts\n";

	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]="ISR(TIMER1_COMPA_vect){//timer1 interrupt 1Hz\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="\tif(!Use_Timer_interrupt1 || Timer_interrupt1_val>="+global_Time_End+") return;\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="\tif(Timer_interrupt1_val<"+global_Time_End+") Timer_interrupt1_val++;\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+= global_Set_Function_Timer +"\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="}";
	return "Use_Timer_interrupt1=true;\n" 
};
// new LowCost PLC Timer Start 
Blockly.smartAgri.Timer_Stop=function(){
	Blockly.smartAgri.variable_["variable_set_Timer_interrupt1_val"]="long Timer_interrupt1_val = 0;\n";
	Blockly.smartAgri.variable_["variable_set_Timer_interrupt1_val"]+="boolean Use_Timer_interrupt1 = false;";

	Blockly.smartAgri.setups_["setup_cli_stop_interrupt"]="\t cli();//stop interrupts";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]="\t //set timer1 interrupt at 1Hz\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1A = 0;// set entire TCCR1A register to 0\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B = 0;// same for TCCR1B\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCNT1  = 0;//initialize counter value to 0\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // set compare match register for 1hz increments\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t OCR1A = 15624;// = (16*10^6) / (1*1024) - 1 (must be <65536)\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // turn on CTC mode\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B |= (1 << WGM12);\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // Set CS12 and CS10 bits for 1024 prescaler\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B |= (1 << CS12) | (1 << CS10);  \n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // enable timer compare interrupt\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TIMSK1 |= (1 << OCIE1A);";
	Blockly.smartAgri.setups_["setup_sei_allow_interrupts"]="\tsei();//allow interrupts\n";

	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]="ISR(TIMER1_COMPA_vect){//timer1 interrupt 1Hz\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="\tif(!Use_Timer_interrupt1 || Timer_interrupt1_val>="+global_Time_End+") return;\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="\tif(Timer_interrupt1_val<"+global_Time_End+") Timer_interrupt1_val++;\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+= global_Set_Function_Timer +"\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="}";
	return "Use_Timer_interrupt1=false;\n" 
};
// new LowCost PLC Timer Val 
Blockly.smartAgri.Timer_Val=function(){
	Blockly.smartAgri.variable_["variable_set_Timer_interrupt1_val"]="long Timer_interrupt1_val = 0;\n";
	Blockly.smartAgri.variable_["variable_set_Timer_interrupt1_val"]+="boolean Use_Timer_interrupt1 = false;";

	Blockly.smartAgri.setups_["setup_cli_stop_interrupt"]="\t cli();//stop interrupts";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]="\t //set timer1 interrupt at 1Hz\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1A = 0;// set entire TCCR1A register to 0\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B = 0;// same for TCCR1B\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCNT1  = 0;//initialize counter value to 0\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // set compare match register for 1hz increments\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t OCR1A = 15624;// = (16*10^6) / (1*1024) - 1 (must be <65536)\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // turn on CTC mode\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B |= (1 << WGM12);\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // Set CS12 and CS10 bits for 1024 prescaler\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TCCR1B |= (1 << CS12) | (1 << CS10);  \n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t // enable timer compare interrupt\n";
	Blockly.smartAgri.setups_["setup_set_timer_interrupt"]+="\t TIMSK1 |= (1 << OCIE1A);";
	Blockly.smartAgri.setups_["setup_sei_allow_interrupts"]="\tsei();//allow interrupts\n";

	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]="ISR(TIMER1_COMPA_vect){//timer1 interrupt 1Hz\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="\tif(!Use_Timer_interrupt1 || Timer_interrupt1_val>="+global_Time_End+") return;\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="\tif(Timer_interrupt1_val<"+global_Time_End+") Timer_interrupt1_val++;\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+= global_Set_Function_Timer +"\n";
	Blockly.smartAgri.function_["function_Set_Timer_interrupt1"]+="}";

	return["Timer_interrupt1_val",Blockly.smartAgri.ORDER_ATOMIC]
};

var global_Counter_End = 99999;
// new LowCost PLC Set Counter 
Blockly.smartAgri.Set_Counter=function(){

  	var Counter_End = Blockly.smartAgri.valueToCode(this, 'Counter_End', Blockly.smartAgri.ORDER_ATOMIC);
  	global_Counter_End = Counter_End;

	Blockly.smartAgri.variable_["variable_Set_Counter"]="long Counter_val=0;\n";

	Blockly.smartAgri.setups_["setup_Set_Counter"]="Counter_val=0;";

	Blockly.smartAgri.function_["function_Set_Counter"]="void setCounter(int _val){\n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tdelay(500);\n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tif(_val==-1 && Counter_val-1>=0) Counter_val--; \n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tif(_val==1 && Counter_val+1<="+global_Counter_End+") Counter_val++; \n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="}";

	return ""
};
// new LowCost PLC Counter Reset 
Blockly.smartAgri.Counter_Reset=function(){
	Blockly.smartAgri.variable_["variable_Set_Counter"]="long Counter_val=0;\n";

	Blockly.smartAgri.setups_["setup_Set_Counter"]="Counter_val=0;";

	Blockly.smartAgri.function_["function_Set_Counter"]="void setCounter(int _val){\n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tdelay(500);\n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tif(_val==-1 && Counter_val-1>=0) Counter_val--; \n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tif(_val==1 && Counter_val+1<="+global_Counter_End+") Counter_val++; \n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="}";
	return "Counter_val=0;\n"

};
// new LowCost PLC Counter UP 
Blockly.smartAgri.Counter_UP=function(){
	Blockly.smartAgri.variable_["variable_Set_Counter"]="long Counter_val=0;\n";

	Blockly.smartAgri.setups_["setup_Set_Counter"]="Counter_val=0;";

	Blockly.smartAgri.function_["function_Set_Counter"]="void setCounter(int _val){\n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tdelay(500);\n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tif(_val==-1 && Counter_val-1>=0) Counter_val--; \n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tif(_val==1 && Counter_val+1<="+global_Counter_End+") Counter_val++; \n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="}";
	return "setCounter(1);\n"
};
// new LowCost PLC Counter Down 
Blockly.smartAgri.Counter_Down=function(){
	Blockly.smartAgri.variable_["variable_Set_Counter"]="long Counter_val=0;\n";

	Blockly.smartAgri.setups_["setup_Set_Counter"]="Counter_val=0;";

	Blockly.smartAgri.function_["function_Set_Counter"]="void setCounter(int _val){\n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tdelay(500);\n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tif(_val==-1 && Counter_val-1>=0) Counter_val--; \n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tif(_val==1 && Counter_val+1<="+global_Counter_End+") Counter_val++; \n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="}";
	return "setCounter(-1);\n"
};

// new LowCost PLC Counter Val 
Blockly.smartAgri.Counter_Val=function(){
	Blockly.smartAgri.variable_["variable_Set_Counter"]="long Counter_val=0;\n";

	Blockly.smartAgri.setups_["setup_Set_Counter"]="Counter_val=0;";

	Blockly.smartAgri.function_["function_Set_Counter"]="void setCounter(int _val){\n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tdelay(500);\n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tif(_val==-1 && Counter_val-1>=0) Counter_val--; \n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="\tif(_val==1 && Counter_val+1<="+global_Counter_End+") Counter_val++; \n";
	Blockly.smartAgri.function_["function_Set_Counter"]+="}";
	return["Counter_val",Blockly.smartAgri.ORDER_ATOMIC]
};






Blockly.smartAgri.inout_digital_read=function(){
	var a=this.getFieldValue("PIN");
	Blockly.smartAgri.setups_["setup_input_"+a]="pinMode("+a+", INPUT);";
	return["digitalRead("+a+")",Blockly.smartAgri.ORDER_ATOMIC]
};
Blockly.smartAgri.inout_tone=function(){
	var a=this.getFieldValue("PIN"),b=Blockly.smartAgri.valueToCode(this,"NUM",Blockly.smartAgri.ORDER_ATOMIC);
	Blockly.smartAgri.setups_["setup_output"+a]="pinMode("+a+", OUTPUT);";return"tone("+a+", "+b+");\n"
};

Blockly.smartAgri.inout_notone=function(){
	var a=this.getFieldValue("PIN");Blockly.smartAgri.setups_["setup_output"+a]="pinMode("+a+", OUTPUT);";return"noTone("+a+");\n"
};
Blockly.smartAgri.inout_highlow=function(){

	return["1"==this.getFieldValue("BOOL")?"1":"0",Blockly.smartAgri.ORDER_ATOMIC]
};

Blockly.smartAgri.loops={};
Blockly.smartAgri.controls_for=function(){
	var a=Blockly.smartAgri.variableDB_.getName(this.getFieldValue("VAR"),Blockly.Variables.NAME_TYPE),b=Blockly.smartAgri.valueToCode(this,"FROM",Blockly.smartAgri.ORDER_ASSIGNMENT)||"0",c=Blockly.smartAgri.valueToCode(this,"TO",Blockly.smartAgri.ORDER_ASSIGNMENT)||"0",d=Blockly.smartAgri.statementToCode(this,"DO");
	Blockly.smartAgri.INFINITE_LOOP_TRAP&&(d=Blockly.smartAgri.INFINITE_LOOP_TRAP.replace(/%1/g,"'"+this.id+"'")+d);
	if(b.match(/^-?\d+(\.\d+)?$/)&&c.match(/^-?\d+(\.\d+)?$/))
		var e=parseFloat(b)<=parseFloat(c),d="for ("+a+" = "+b+"; "+a+(e?" <= ":" >= ")+c+"; "+a+(e?"++":"--")+") {\n"+d+"}\n";else d="",e=b,b.match(/^\w+$/)||b.match(/^-?\d+(\.\d+)?$/)||(e=Blockly.smartAgri.variableDB_.getDistinctName(a+"_start",Blockly.Variables.NAME_TYPE),d+="int "+e+" = "+b+";\n"),b=c,c.match(/^\w+$/)||c.match(/^-?\d+(\.\d+)?$/)||(b=Blockly.smartAgri.variableDB_.getDistinctName(a+"_end",Blockly.Variables.NAME_TYPE),d+="int "+b+" = "+c+";\n"),d+="for ("+a+" = "+e+";\n    ("+e+" <= "+b+") ? "+a+" <= "+b+" : "+a+" >= "+b+";\n    "+a+" += ("+e+" <= "+b+") ? 1 : -1) {\n"+branch0+"}\n";
	return d
};

Blockly.smartAgri.controls_whileUntil=function(){
	var a="UNTIL"==this.getFieldValue("MODE"),b=Blockly.smartAgri.valueToCode(this,"BOOL",a?Blockly.smartAgri.ORDER_LOGICAL_NOT:Blockly.smartAgri.ORDER_NONE)||"false",c=Blockly.smartAgri.statementToCode(this,"DO");
	Blockly.smartAgri.INFINITE_LOOP_TRAP&&(c=Blockly.smartAgri.INFINITE_LOOP_TRAP.replace(/%1/g,"'"+this.id+"'")+c);a&&(b="!"+b);
	return"while ("+b+") {\n"+c+"}\n"
};
Blockly.smartAgri.grove={};

Blockly.smartAgri.grove_led=function(){
	var a=this.getFieldValue("PIN"),b=this.getFieldValue("STAT");
	Blockly.smartAgri.setups_["setup_green_led_"+a]="pinMode("+a+", OUTPUT);";return"digitalWrite("+a+","+b+");\n"
};

Blockly.smartAgri.grove_button=function(){
	var a=this.getFieldValue("PIN");Blockly.smartAgri.setups_["setup_button_"+a]="pinMode("+a+", INPUT);";return["digitalRead("+a+")",Blockly.smartAgri.ORDER_ATOMIC]
};
Blockly.smartAgri.grove_rotary_angle=function(){
	return["analogRead("+this.getFieldValue("PIN")+")",Blockly.smartAgri.ORDER_ATOMIC]
};
Blockly.smartAgri.grove_tilt_switch=function(){
	var a=this.getFieldValue("PIN");Blockly.smartAgri.setups_["setup_tilt_switch_"+a]="pinMode("+a+", INPUT);";return["digitalRead("+a+")",Blockly.smartAgri.ORDER_ATOMIC]
};
Blockly.smartAgri.grove_piezo_buzzer=function(){
	var a=this.getFieldValue("PIN"),b=this.getFieldValue("STAT");
	Blockly.smartAgri.setups_["setup_piezo_buzzer_"+a]="pinMode("+a+", OUTPUT);";return"digitalWrite("+a+","+b+");\n"
};
Blockly.smartAgri.grove_relay=function(){
	var a=this.getFieldValue("PIN"),b=this.getFieldValue("STAT");
	Blockly.smartAgri.setups_["setup_relay_"+a]="pinMode("+a+", OUTPUT);";return"digitalWrite("+a+","+b+");\n"
};
Blockly.smartAgri.grove_temporature_sensor=function(){
	var a=this.getFieldValue("PIN");
	return["round((1/(log((float)(1023-analogRead("+a+"))*10000/analogRead("+a+"))/10000)/3975+1/298.15)-273.15)",Blockly.smartAgri.ORDER_ATOMIC]
};
var _get_next_pin=function(a){
	var b=a,b=parseInt(b)?parseInt(a)+1:"A"+(parseInt(b.slice(1,b.length))+1);
	a=profile["default"].digital.length;for(var c=!0,d=0;d<a;d++)profile["default"].digital[d][1]==b&&(c=!1);
	return c?(alert("Grove Sensor needs PIN#+1 port, current setting is out of bound."),null):b
};
Blockly.smartAgri.grove_serial_lcd_print=function(){
	var a=this.getFieldValue("PIN"),b=Blockly.smartAgri.valueToCode(this,"TEXT",Blockly.smartAgri.ORDER_UNARY_POSTFIX)||"''",c=Blockly.smartAgri.valueToCode(this,"TEXT2",Blockly.smartAgri.ORDER_UNARY_POSTFIX)||"''",d=Blockly.smartAgri.valueToCode(this,"DELAY_TIME",Blockly.smartAgri.ORDER_ATOMIC)||"1000";Blockly.smartAgri.definitions_.define_seriallcd="#include <SerialLCD.h>\n";
	Blockly.smartAgri.definitions_.define_softwareserial="#include <SoftwareSerial.h>\n";
	var e=_get_next_pin(a);
	Blockly.smartAgri.definitions_["var_lcd_"+a]="SerialLCD slcd_"+a+"("+a+","+e+");\n";
	Blockly.smartAgri.setups_["setup_lcd_"+a]="slcd_"+a+".begin();\n";e="slcd_"+a+".backlight();\n"+("slcd_"+a+".setCursor(0,0);\n");
	e+="slcd_"+a+".print("+b+");\n";e+="slcd_"+a+".setCursor(0,1);\n";e+="slcd_"+a+".print("+c+");\n";return e+="delay("+d+");\n"
};
Blockly.smartAgri.grove_serial_lcd_power=function(){
	var a=this.getFieldValue("PIN"),b=this.getFieldValue("STAT");
	Blockly.smartAgri.definitions_.define_seriallcd="#include <SerialLCD.h>\n";
	Blockly.smartAgri.definitions_.define_softwareserial="#include <SoftwareSerial.h>\n";
	var c=_get_next_pin(a);Blockly.smartAgri.definitions_["var_lcd"+a]="SerialLCD slcd_"+a+"("+a+","+c+");\n";
	a="slcd_"+a;return"ON"===b?a+".Power();\n":a+".noPower();\n"
};
Blockly.smartAgri.grove_serial_lcd_effect=function(){
	var a=this.getFieldValue("PIN"),b=this.getFieldValue("STAT");
	Blockly.smartAgri.definitions_.define_seriallcd="#include <SerialLCD.h>\n";
	Blockly.smartAgri.definitions_.define_softwareserial="#include <SoftwareSerial.h>\n";var c=_get_next_pin(a);
	Blockly.smartAgri.definitions_["var_lcd"+a]="SerialLCD slcd_"+a+"("+a+","+c+");\n";a="slcd_"+a;return"LEFT"===b?a+".scrollDisplayLeft();\n":"RIGHT"===b?a+".scrollDisplayRight();\n":a+".autoscroll();\n"
};
Blockly.smartAgri.grove_sound_sensor=function(){
	return["analogRead("+this.getFieldValue("PIN")+")",Blockly.smartAgri.ORDER_ATOMIC]
};
Blockly.smartAgri.grove_pir_motion_sensor=function(){
	var a=this.getFieldValue("PIN");Blockly.smartAgri.setups_["setup_input_"+a]="pinMode("+a+", INPUT);";return["digitalRead("+a+")",Blockly.smartAgri.ORDER_ATOMIC]
};
Blockly.smartAgri.grove_line_finder=function(){
	var a=this.getFieldValue("PIN");
	Blockly.smartAgri.setups_["setup_input_"+a]="pinMode("+a+", INPUT);";return["digitalRead("+a+")",Blockly.smartAgri.ORDER_ATOMIC]
};
Blockly.smartAgri.grove_ultrasonic_ranger=function(){
	var a=this.getFieldValue("PIN"),b=this.getFieldValue("UNIT");
	Blockly.smartAgri.definitions_.define_ultrasonic="#include <Ultrasonic.h>\n";Blockly.smartAgri.definitions_["var_ultrasonic"+a]="Ultrasonic ultrasonic_"+a+"("+a+");";return["cm"===b?"ultrasonic_"+a+".MeasureInCentimeters()":"ultrasonic_"+a+".MeasureInInches()",Blockly.smartAgri.ORDER_ATOMIC]
};
Blockly.smartAgri.grove_motor_shield=function(){
	var a=this.getFieldValue("DIRECTION");
	Blockly.smartAgri.setups_.setup_motor="pinMode(8,OUTPUT);//I1\n  pinMode(11,OUTPUT);//I2\n  pinMode(9,OUTPUT);//speedPinA\n  pinMode(12,OUTPUT);//I3\n  pinMode(13,OUTPUT);//i4\n  pinMode(10,OUTPUT);//speedPinB\n";
	var b="";"forward"===a?(Blockly.smartAgri.definitions_.define_forward="void forward()\n{\n  analogWrite(9,127);//input a simulation value to set the speed\n  analogWrite(10,127);\n  digitalWrite(13,HIGH);//turn DC Motor B move clockwise\n  digitalWrite(12,LOW);\n  digitalWrite(11,LOW);//turn DC Motor A move anticlockwise\n  digitalWrite(8,HIGH);\n}\n",
	b="forward();\n"):"right"===a?(Blockly.smartAgri.definitions_.define_right="void right()\n{\n  analogWrite(9,127);//input a simulation value to set the speed\n  analogWrite(10,127);\n  digitalWrite(13,LOW);//turn DC Motor B move anticlockwise\n  digitalWrite(12,HIGH);\n  digitalWrite(11,LOW);//turn DC Motor A move anticlockwise\n  digitalWrite(8,HIGH);\n}\n\n",b="right();\n"):"left"===a?(Blockly.smartAgri.definitions_.define_left="void left()\n{\n  analogWrite(9,127);//input a simulation value to set the speed\n  analogWrite(10,127);\n  digitalWrite(13,HIGH);//turn DC Motor B move clockwise\n  digitalWrite(12,LOW);\n  digitalWrite(11,HIGH);//turn DC Motor A move clockwise\n  digitalWrite(8,LOW);\n}\n\n",
	b="left();\n"):"backward"===a?(Blockly.smartAgri.definitions_.define_backward="void backward()\n{\n  analogWrite(9,127);//input a simulation value to set the speed\n  analogWrite(10,127);\n  digitalWrite(13,LOW);//turn DC Motor B move anticlockwise\n  digitalWrite(12,HIGH);\n  digitalWrite(11,HIGH);//turn DC Motor A move clockwise\n  digitalWrite(8,LOW);\n}\n\n",b="backward();\n"):"stop"===a&&(Blockly.smartAgri.definitions_.define_stop="void stop()\n{\ndigitalWrite(9,LOW);// Unenble the pin, to stop the motor. this should be done to avid damaging the motor.\ndigitalWrite(10,LOW);\ndelay(1000);\n}\n\n",
	b="stop();\n");return b};Blockly.smartAgri.grove_thumb_joystick=function(){
		var a=this.getFieldValue("PIN"),b="0",b="y"===this.getFieldValue("AXIS")?_get_next_pin(a):a;
		return["analogRead("+b+")",Blockly.smartAgri.ORDER_ATOMIC]
};
function hexToR(a){
 	return parseInt(cutHex(a).substring(0,2),16)
}
function hexToG(a){
	return parseInt(cutHex(a).substring(2,4),16)
}
function hexToB(a){
	return parseInt(cutHex(a).substring(4,6),16)
}
function cutHex(a){
	return"#"==a.charAt(0)?a.substring(1,7):a
}
Blockly.smartAgri.grove_rgb_led=function(){
	var a=this.getFieldValue("PIN"),b=_get_next_pin(a);Blockly.smartAgri.setups_["setup_input_"+a]="pinMode("+a+", OUTPUT);";
	Blockly.smartAgri.setups_["setup_input_"+b]="pinMode("+b+", OUTPUT);";
	Blockly.smartAgri.definitions_.define_uint8="#define uint8 unsigned char";
	Blockly.smartAgri.definitions_.define_uint16="#define uint16 unsigned int";
	Blockly.smartAgri.definitions_.define_uint32="#define uint32 unsigned long int";
	Blockly.smartAgri.definitions_["define_clkproduce_"+a]="void ClkProduce_"+a+"(void)\n{\n  digitalWrite("+a+", LOW);\n  delayMicroseconds(20);\n  digitalWrite("+a+", HIGH);\n  delayMicroseconds(20);\n}\n";
	Blockly.smartAgri.definitions_["define_send32zero_"+a]="void Send32Zero_"+a+"(void)\n{\n  uint8 i;\n  for (i=0; i<32; i++)\n  {\n    digitalWrite("+b+", LOW);\n    ClkProduce_"+a+"();\n  }\n}\n";
	Blockly.smartAgri.definitions_.define_taskanticode="uint8 TakeAntiCode(uint8 dat)\n{\n  uint8 tmp = 0;\n  if ((dat & 0x80) == 0)\n  {\n    tmp |= 0x02;\n  }\n  \n  if ((dat & 0x40) == 0)\n  {\n    tmp |= 0x01;\n  }\n  return tmp;\n}\n";
	Blockly.smartAgri.definitions_["define_datasend_"+a]="// gray data\nvoid DatSend_"+a+"(uint32 dx)\n{\n  uint8 i;\n  for (i=0; i<32; i++)\n  {\n    if ((dx & 0x80000000) != 0)\n    {\n      digitalWrite("+b+", HIGH);\n    }\n    else\n    {\n      digitalWrite("+b+", LOW);\n    }\n  dx <<= 1;\n  ClkProduce_"+a+"();\n  }\n}\n";
	Blockly.smartAgri.definitions_["define_datadealwithsend_"+a]="// data processing\nvoid DataDealWithAndSend_"+a+"(uint8 r, uint8 g, uint8 b)\n{\n  uint32 dx = 0;\n  dx |= (uint32)0x03 << 30;             // highest two bits 1\uff0cflag bits\n  dx |= (uint32)TakeAntiCode(b) << 28;\n  dx |= (uint32)TakeAntiCode(g) << 26;\n  dx |= (uint32)TakeAntiCode(r) << 24;\n\n  dx |= (uint32)b << 16;\n  dx |= (uint32)g << 8;\n  dx |= r;\n\n  DatSend_"+
	a+"(dx);\n}\n";b="Send32Zero_"+a+"(); // begin\n";if(0==this.itemCount_)
	return"";
	for(var c=0;c<this.itemCount_;c++)
		var d=this.getFieldValue("RGB"+c),b=b+("DataDealWithAndSend_"+a+"("+hexToR(d)+", "+hexToG(d)+", "+hexToB(d)+"); // first node data\n");return b+("Send32Zero_"+a+"();  // send to update data\n")
};
Blockly.smartAgri.grove_bluetooth_slave=function(){
	var a=this.getFieldValue("PIN"),b=_get_next_pin(a),c=this.getFieldValue("NAME");
	this.getFieldValue("PINCODE");
	var d=Blockly.smartAgri.statementToCode(this,"RCV"),e=Blockly.smartAgri.statementToCode(this,"SNT");
	Blockly.smartAgri.definitions_.define_softwareserial="#include <SoftwareSerial.h>\n";
	Blockly.smartAgri.definitions_["var_bluetooth_"+a]="SoftwareSerial blueToothSerial_"+a+"("+a+","+b+");\n";
	Blockly.smartAgri.setups_["setup_bluetooth_"+a]="Serial.begin(9600);\n";
	Blockly.smartAgri.setups_["setup_bluetooth_"+a]+="  pinMode("+a+", INPUT);\n";
	Blockly.smartAgri.setups_["setup_bluetooth_"+a]+="  pinMode("+b+", OUTPUT);\n";
	Blockly.smartAgri.setups_["setup_bluetooth_"+a]+="  setupBlueToothConnection_"+a+"();\n";
	Blockly.smartAgri.definitions_["define_setupBlueToothConnection_"+a]="void setupBlueToothConnection_"+a+"()\n{\n  blueToothSerial_"+a+".begin(38400); //Set BluetoothBee BaudRate to default baud rate 38400\n  blueToothSerial_"+a+'.print("\\r\\n+STWMOD=0\\r\\n"); //set the bluetooth work in slave mode\n  blueToothSerial_'+
	a+'.print("\\r\\n+STNA='+c+'\\r\\n"); //set the bluetooth name as "'+c+'"\n  blueToothSerial_'+a+'.print("\\r\\n+STPIN=0000\\r\\n");//Set SLAVE pincode"0000"\n  blueToothSerial_'+a+'.print("\\r\\n+STOAUT=1\\r\\n"); // Permit Paired device to connect me\n  blueToothSerial_'+a+'.print("\\r\\n+STAUTO=0\\r\\n"); // Auto-connection should be forbidden here\n  delay(2000); // This delay is required.\n  blueToothSerial_'+a+'.print("\\r\\n+INQ=1\\r\\n"); //make the slave bluetooth inquirable \n  Serial.println("The slave bluetooth is inquirable!");\n  delay(2000); // This delay is required.\n  blueToothSerial_'+
	a+".flush();\n}\n";return"char recvChar_"+a+";\nwhile(1) {\n  if(blueToothSerial_"+a+".available()) {//check if there is any data sent from the remote bluetooth shield\n    recvChar_"+a+" = blueToothSerial_"+a+".read();\n    Serial.print(recvChar_"+a+");\n"+d+"  }\n  if(Serial.available()){//check if there is any data sent from the local serial terminal, you can add the other applications here\n    recvChar_"+a+" = Serial.read();\n    blueToothSerial_"+a+".print(recvChar_"+a+");\n"+e+"  }\n}\n"
};

Blockly.smartAgri.logic={};
Blockly.smartAgri.controls_if=function(){
	for(var a=0,b=Blockly.smartAgri.valueToCode(this,"IF"+a,Blockly.smartAgri.ORDER_NONE)||"false",c=Blockly.smartAgri.statementToCode(this,"DO"+a),d="if ("+b+") {\n"+c+"\n}",a=1;a<=this.elseifCount_;a++)b=Blockly.smartAgri.valueToCode(this,"IF"+a,Blockly.smartAgri.ORDER_NONE)||"false",c=Blockly.smartAgri.statementToCode(this,"DO"+a),d+=" else if ("+b+") {\n"+c+"}";
		this.elseCount_&&(c=Blockly.smartAgri.statementToCode(this,"ELSE"),d+=" else {\n"+c+"\n}");
	return d+"\n"
};
Blockly.smartAgri.logic_compare=function(){
	var a=this.getFieldValue("OP"),a=Blockly.smartAgri.logic_compare.OPERATORS[a],b="=="==a||"!="==a?Blockly.smartAgri.ORDER_EQUALITY:Blockly.smartAgri.ORDER_RELATIONAL,c=Blockly.smartAgri.valueToCode(this,"A",b)||"0",d=Blockly.smartAgri.valueToCode(this,"B",b)||"0";
	return[c+" "+a+" "+d,b]};Blockly.smartAgri.logic_compare.OPERATORS={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="
};
Blockly.smartAgri.logic_operation=function(){
	var a="AND"==this.getFieldValue("OP")?"&&":"||",b="&&"==a?Blockly.smartAgri.ORDER_LOGICAL_AND:Blockly.smartAgri.ORDER_LOGICAL_OR,c=Blockly.smartAgri.valueToCode(this,"A",b)||"false",d=Blockly.smartAgri.valueToCode(this,"B",b)||"false";return[c+" "+a+" "+d,b]
};
Blockly.smartAgri.logic_negate=function(){
	var a=Blockly.smartAgri.ORDER_UNARY_PREFIX;
	return["!"+(Blockly.smartAgri.valueToCode(this,"BOOL",a)||"false"),a]
};
Blockly.smartAgri.logic_boolean=function(){
	return["TRUE"==this.getFieldValue("BOOL")?"true":"false",Blockly.smartAgri.ORDER_ATOMIC]
};
Blockly.smartAgri.logic_null=function(){
	return["NULL",Blockly.smartAgri.ORDER_ATOMIC]
};
Blockly.smartAgri.math={};
Blockly.smartAgri.math_number=function(){
	var a=window.parseFloat(this.getFieldValue("NUM"));
	return[a,0>a?Blockly.smartAgri.ORDER_UNARY_PREFIX:Blockly.smartAgri.ORDER_ATOMIC]
};
Blockly.smartAgri.math_arithmetic=function(){
	var a=this.getFieldValue("OP"),b=Blockly.smartAgri.math_arithmetic.OPERATORS[a],a=b[0],b=b[1],c=Blockly.smartAgri.valueToCode(this,"A",b)||"0",d=Blockly.smartAgri.valueToCode(this,"B",b)||"0";return a?[c+a+d,b]:["Math.pow("+c+", "+d+")",Blockly.smartAgri.ORDER_UNARY_POSTFIX]
};
Blockly.smartAgri.math_arithmetic.OPERATORS={
	ADD:[" + ",Blockly.smartAgri.ORDER_ADDITIVE],
	MINUS:[" - ",Blockly.smartAgri.ORDER_ADDITIVE],
	MULTIPLY:[" * ",Blockly.smartAgri.ORDER_MULTIPLICATIVE],
	DIVIDE:[" / ",Blockly.smartAgri.ORDER_MULTIPLICATIVE],
	POWER:[null,Blockly.smartAgri.ORDER_NONE]
};
Blockly.smartAgri.procedures={};
Blockly.smartAgri.procedures_defreturn=function(){
	var a=Blockly.smartAgri.variableDB_.getName(this.getFieldValue("NAME"),Blockly.Procedures.NAME_TYPE),b=Blockly.smartAgri.statementToCode(this,"STACK");
	Blockly.smartAgri.INFINITE_LOOP_TRAP&&(b=Blockly.smartAgri.INFINITE_LOOP_TRAP.replace(/%1/g,"'"+this.id+"'")+b);
	var c=Blockly.smartAgri.valueToCode(this,"RETURN",Blockly.smartAgri.ORDER_NONE)||"";c&&(c="  return "+c+";\n");for(var d=c?"int":"void",e=[],f=0;f<this.arguments_.length;f++)e[f]="int "+Blockly.smartAgri.variableDB_.getName(this.arguments_[f],
Blockly.Variables.NAME_TYPE);b=d+" "+a+"("+e.join(", ")+") {\n"+b+c+"}\n";
	b=Blockly.smartAgri.scrub_(this,b);Blockly.smartAgri.definitions_[a]=b;
	return null
};
Blockly.smartAgri.procedures_defnoreturn=Blockly.smartAgri.procedures_defreturn;

Blockly.smartAgri.procedures_callreturn=function(){
	for(var a=Blockly.smartAgri.variableDB_.getName(this.getFieldValue("NAME"),Blockly.Procedures.NAME_TYPE),b=[],c=0;c<this.arguments_.length;c++)b[c]=Blockly.smartAgri.valueToCode(this,"ARG"+c,Blockly.smartAgri.ORDER_NONE)||"null";return[a+"("+b.join(", ")+")",Blockly.smartAgri.ORDER_UNARY_POSTFIX]
};
Blockly.smartAgri.procedures_callnoreturn=function(){
	for(var a=Blockly.smartAgri.variableDB_.getName(this.getFieldValue("NAME"),Blockly.Procedures.NAME_TYPE),b=[],c=0;c<this.arguments_.length;c++)b[c]=Blockly.smartAgri.valueToCode(this,"ARG"+c,Blockly.smartAgri.ORDER_NONE)||"null";return a+"("+b.join(", ")+");\n"
};
Blockly.smartAgri.procedures_ifreturn=function(){
	var a="if ("+(Blockly.smartAgri.valueToCode(this,"CONDITION",Blockly.smartAgri.ORDER_NONE)||"false")+") {\n";
	if(this.hasReturnValue_)
		var b=Blockly.smartAgri.valueToCode(this,"VALUE",Blockly.smartAgri.ORDER_NONE)||"null",a=a+("  return "+b+";\n");else a+="  return;\n";return a+"}\n"
};
Blockly.smartAgri.texts={};
Blockly.smartAgri.text=function(){
	return[Blockly.smartAgri.quote_(this.getFieldValue("TEXT")),Blockly.smartAgri.ORDER_ATOMIC]
};
Blockly.smartAgri.variables={};
Blockly.smartAgri.variables_get=function(){
	return[Blockly.smartAgri.variableDB_.getName(this.getFieldValue("VAR"),Blockly.Variables.NAME_TYPE),Blockly.smartAgri.ORDER_ATOMIC]
};
Blockly.smartAgri.variables_declare=function(){
	this.getFieldValue("TYPE");var a=Blockly.smartAgri.valueToCode(this,"VALUE",Blockly.smartAgri.ORDER_ASSIGNMENT)||"0",b=Blockly.smartAgri.variableDB_.getName(this.getFieldValue("VAR"),Blockly.Variables.NAME_TYPE);
	Blockly.smartAgri.setups_["setup_var"+b]=b+" = "+a+";\n";return""
};
Blockly.smartAgri.variables_set=function(){
	var a=Blockly.smartAgri.valueToCode(this,"VALUE",Blockly.smartAgri.ORDER_ASSIGNMENT)||"0";
	return Blockly.smartAgri.variableDB_.getName(this.getFieldValue("VAR"),Blockly.Variables.NAME_TYPE)+" = "+a+";\n"
};